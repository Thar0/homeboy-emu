# CARDBlock.c
.include "macros.inc"

.section .text, "ax"

.balign 4

glabel __CARDGetFatBlock
/* 0C4124 800C96C4 80630088 */  lwz     r3, 0x88(r3)
/* 0C4128 800C96C8 4E800020 */  blr     

WriteCallback:
/* 0C412C 800C96CC 7C0802A6 */  mflr    r0
/* 0C4130 800C96D0 90010004 */  stw     r0, 4(r1)
/* 0C4134 800C96D4 9421FFE0 */  stwu    r1, -0x20(r1)
/* 0C4138 800C96D8 93E1001C */  stw     r31, 0x1c(r1)
/* 0C413C 800C96DC 93C10018 */  stw     r30, 0x18(r1)
/* 0C4140 800C96E0 7C9E2379 */  or.     r30, r4, r4
/* 0C4144 800C96E4 93A10014 */  stw     r29, 0x14(r1)
/* 0C4148 800C96E8 3BA30000 */  addi    r29, r3, 0
/* 0C414C 800C96EC 1CBD0110 */  mulli   r5, r29, 0x110
/* 0C4150 800C96F0 3C608014 */  lis     r3, __CARDBlock@ha
/* 0C4154 800C96F4 380324D0 */  addi    r0, r3, __CARDBlock@l
/* 0C4158 800C96F8 7FE02A14 */  add     r31, r0, r5
/* 0C415C 800C96FC 41800048 */  blt     lbl_800C9744
/* 0C4160 800C9700 807F0080 */  lwz     r3, 0x80(r31)
/* 0C4164 800C9704 801F0088 */  lwz     r0, 0x88(r31)
/* 0C4168 800C9708 38836000 */  addi    r4, r3, 0x6000
/* 0C416C 800C970C 7C002040 */  cmplw   r0, r4
/* 0C4170 800C9710 3CA30001 */  addis   r5, r3, 1
/* 0C4174 800C9714 38A58000 */  addi    r5, r5, -32768
/* 0C4178 800C9718 40820018 */  bne     lbl_800C9730
/* 0C417C 800C971C 90BF0088 */  stw     r5, 0x88(r31)
/* 0C4180 800C9720 38650000 */  addi    r3, r5, 0
/* 0C4184 800C9724 38A02000 */  li      r5, 0x2000
/* 0C4188 800C9728 4BF3BD9D */  bl      memcpy
/* 0C418C 800C972C 48000018 */  b       lbl_800C9744
lbl_800C9730:
/* 0C4190 800C9730 909F0088 */  stw     r4, 0x88(r31)
/* 0C4194 800C9734 38640000 */  addi    r3, r4, 0
/* 0C4198 800C9738 38850000 */  addi    r4, r5, 0
/* 0C419C 800C973C 38A02000 */  li      r5, 0x2000
/* 0C41A0 800C9740 4BF3BD85 */  bl      memcpy
lbl_800C9744:
/* 0C41A4 800C9744 801F00D0 */  lwz     r0, 0xd0(r31)
/* 0C41A8 800C9748 28000000 */  cmplwi  r0, 0
/* 0C41AC 800C974C 40820010 */  bne     lbl_800C975C
/* 0C41B0 800C9750 387F0000 */  addi    r3, r31, 0
/* 0C41B4 800C9754 389E0000 */  addi    r4, r30, 0
/* 0C41B8 800C9758 4BFFE7A9 */  bl      __CARDPutControlBlock
lbl_800C975C:
/* 0C41BC 800C975C 801F00D8 */  lwz     r0, 0xd8(r31)
/* 0C41C0 800C9760 28000000 */  cmplwi  r0, 0
/* 0C41C4 800C9764 7C0C0378 */  mr      r12, r0
/* 0C41C8 800C9768 4182001C */  beq     lbl_800C9784
/* 0C41CC 800C976C 38000000 */  li      r0, 0
/* 0C41D0 800C9770 7D8803A6 */  mtlr    r12
/* 0C41D4 800C9774 901F00D8 */  stw     r0, 0xd8(r31)
/* 0C41D8 800C9778 387D0000 */  addi    r3, r29, 0
/* 0C41DC 800C977C 389E0000 */  addi    r4, r30, 0
/* 0C41E0 800C9780 4E800021 */  blrl    
lbl_800C9784:
/* 0C41E4 800C9784 80010024 */  lwz     r0, 0x24(r1)
/* 0C41E8 800C9788 83E1001C */  lwz     r31, 0x1c(r1)
/* 0C41EC 800C978C 83C10018 */  lwz     r30, 0x18(r1)
/* 0C41F0 800C9790 83A10014 */  lwz     r29, 0x14(r1)
/* 0C41F4 800C9794 38210020 */  addi    r1, r1, 0x20
/* 0C41F8 800C9798 7C0803A6 */  mtlr    r0
/* 0C41FC 800C979C 4E800020 */  blr     

EraseCallback:
/* 0C4200 800C97A0 7C0802A6 */  mflr    r0
/* 0C4204 800C97A4 90010004 */  stw     r0, 4(r1)
/* 0C4208 800C97A8 9421FFD8 */  stwu    r1, -0x28(r1)
/* 0C420C 800C97AC 93E10024 */  stw     r31, 0x24(r1)
/* 0C4210 800C97B0 3BE30000 */  addi    r31, r3, 0
/* 0C4214 800C97B4 3C608014 */  lis     r3, __CARDBlock@ha
/* 0C4218 800C97B8 93C10020 */  stw     r30, 0x20(r1)
/* 0C421C 800C97BC 1CBF0110 */  mulli   r5, r31, 0x110
/* 0C4220 800C97C0 93A1001C */  stw     r29, 0x1c(r1)
/* 0C4224 800C97C4 380324D0 */  addi    r0, r3, __CARDBlock@l
/* 0C4228 800C97C8 7C9D2379 */  or.     r29, r4, r4
/* 0C422C 800C97CC 7FC02A14 */  add     r30, r0, r5
/* 0C4230 800C97D0 4180003C */  blt     lbl_800C980C
/* 0C4234 800C97D4 80BE0088 */  lwz     r5, 0x88(r30)
/* 0C4238 800C97D8 3C60800D */  lis     r3, WriteCallback@ha
/* 0C423C 800C97DC 801E0080 */  lwz     r0, 0x80(r30)
/* 0C4240 800C97E0 38E396CC */  addi    r7, r3, WriteCallback@l
/* 0C4244 800C97E4 807E000C */  lwz     r3, 0xc(r30)
/* 0C4248 800C97E8 7C002850 */  subf    r0, r0, r5
/* 0C424C 800C97EC 54009B7E */  srwi    r0, r0, 0xd
/* 0C4250 800C97F0 7C8301D6 */  mullw   r4, r3, r0
/* 0C4254 800C97F4 38C50000 */  addi    r6, r5, 0
/* 0C4258 800C97F8 387F0000 */  addi    r3, r31, 0
/* 0C425C 800C97FC 38A02000 */  li      r5, 0x2000
/* 0C4260 800C9800 4BFFFE49 */  bl      __CARDWrite
/* 0C4264 800C9804 7C7D1B79 */  or.     r29, r3, r3
/* 0C4268 800C9808 40800044 */  bge     lbl_800C984C
lbl_800C980C:
/* 0C426C 800C980C 801E00D0 */  lwz     r0, 0xd0(r30)
/* 0C4270 800C9810 28000000 */  cmplwi  r0, 0
/* 0C4274 800C9814 40820010 */  bne     lbl_800C9824
/* 0C4278 800C9818 387E0000 */  addi    r3, r30, 0
/* 0C427C 800C981C 389D0000 */  addi    r4, r29, 0
/* 0C4280 800C9820 4BFFE6E1 */  bl      __CARDPutControlBlock
lbl_800C9824:
/* 0C4284 800C9824 801E00D8 */  lwz     r0, 0xd8(r30)
/* 0C4288 800C9828 28000000 */  cmplwi  r0, 0
/* 0C428C 800C982C 7C0C0378 */  mr      r12, r0
/* 0C4290 800C9830 4182001C */  beq     lbl_800C984C
/* 0C4294 800C9834 38000000 */  li      r0, 0
/* 0C4298 800C9838 7D8803A6 */  mtlr    r12
/* 0C429C 800C983C 901E00D8 */  stw     r0, 0xd8(r30)
/* 0C42A0 800C9840 387F0000 */  addi    r3, r31, 0
/* 0C42A4 800C9844 389D0000 */  addi    r4, r29, 0
/* 0C42A8 800C9848 4E800021 */  blrl    
lbl_800C984C:
/* 0C42AC 800C984C 8001002C */  lwz     r0, 0x2c(r1)
/* 0C42B0 800C9850 83E10024 */  lwz     r31, 0x24(r1)
/* 0C42B4 800C9854 83C10020 */  lwz     r30, 0x20(r1)
/* 0C42B8 800C9858 83A1001C */  lwz     r29, 0x1c(r1)
/* 0C42BC 800C985C 38210028 */  addi    r1, r1, 0x28
/* 0C42C0 800C9860 7C0803A6 */  mtlr    r0
/* 0C42C4 800C9864 4E800020 */  blr     

glabel __CARDAllocBlock
/* 0C42C8 800C9868 7C0802A6 */  mflr    r0
/* 0C42CC 800C986C 1CE30110 */  mulli   r7, r3, 0x110
/* 0C42D0 800C9870 90010004 */  stw     r0, 4(r1)
/* 0C42D4 800C9874 9421FFE0 */  stwu    r1, -0x20(r1)
/* 0C42D8 800C9878 3CC08014 */  lis     r6, __CARDBlock@ha
/* 0C42DC 800C987C 380624D0 */  addi    r0, r6, __CARDBlock@l
/* 0C42E0 800C9880 93E1001C */  stw     r31, 0x1c(r1)
/* 0C42E4 800C9884 7D203A14 */  add     r9, r0, r7
/* 0C42E8 800C9888 93C10018 */  stw     r30, 0x18(r1)
/* 0C42EC 800C988C 80090000 */  lwz     r0, 0(r9)
/* 0C42F0 800C9890 2C000000 */  cmpwi   r0, 0
/* 0C42F4 800C9894 4082000C */  bne     lbl_800C98A0
/* 0C42F8 800C9898 3860FFFD */  li      r3, -3
/* 0C42FC 800C989C 480000CC */  b       lbl_800C9968
lbl_800C98A0:
/* 0C4300 800C98A0 81090088 */  lwz     r8, 0x88(r9)
/* 0C4304 800C98A4 A0080006 */  lhz     r0, 6(r8)
/* 0C4308 800C98A8 7C002040 */  cmplw   r0, r4
/* 0C430C 800C98AC 4080000C */  bge     lbl_800C98B8
/* 0C4310 800C98B0 3860FFF7 */  li      r3, -9
/* 0C4314 800C98B4 480000B4 */  b       lbl_800C9968
lbl_800C98B8:
/* 0C4318 800C98B8 7C040050 */  subf    r0, r4, r0
/* 0C431C 800C98BC B0080006 */  sth     r0, 6(r8)
/* 0C4320 800C98C0 3CC00001 */  lis     r6, 1
/* 0C4324 800C98C4 3986FFFF */  addi    r12, r6, -1
/* 0C4328 800C98C8 A1680008 */  lhz     r11, 8(r8)
/* 0C432C 800C98CC 380C0000 */  addi    r0, r12, 0
/* 0C4330 800C98D0 3BC00000 */  li      r30, 0
/* 0C4334 800C98D4 4800007C */  b       lbl_800C9950
lbl_800C98D8:
/* 0C4338 800C98D8 A1490010 */  lhz     r10, 0x10(r9)
/* 0C433C 800C98DC 3BDE0001 */  addi    r30, r30, 1
/* 0C4340 800C98E0 57C6043E */  clrlwi  r6, r30, 0x10
/* 0C4344 800C98E4 38EAFFFB */  addi    r7, r10, -5
/* 0C4348 800C98E8 7C073000 */  cmpw    r7, r6
/* 0C434C 800C98EC 4080000C */  bge     lbl_800C98F8
/* 0C4350 800C98F0 3860FFFA */  li      r3, -6
/* 0C4354 800C98F4 48000074 */  b       lbl_800C9968
lbl_800C98F8:
/* 0C4358 800C98F8 396B0001 */  addi    r11, r11, 1
/* 0C435C 800C98FC 5566043E */  clrlwi  r6, r11, 0x10
/* 0C4360 800C9900 28060005 */  cmplwi  r6, 5
/* 0C4364 800C9904 4180000C */  blt     lbl_800C9910
/* 0C4368 800C9908 7C065040 */  cmplw   r6, r10
/* 0C436C 800C990C 41800008 */  blt     lbl_800C9914
lbl_800C9910:
/* 0C4370 800C9910 39600005 */  li      r11, 5
lbl_800C9914:
/* 0C4374 800C9914 55660BFC */  rlwinm  r6, r11, 1, 0xf, 0x1e
/* 0C4378 800C9918 7CE83214 */  add     r7, r8, r6
/* 0C437C 800C991C A0C70000 */  lhz     r6, 0(r7)
/* 0C4380 800C9920 28060000 */  cmplwi  r6, 0
/* 0C4384 800C9924 4082002C */  bne     lbl_800C9950
/* 0C4388 800C9928 5586043E */  clrlwi  r6, r12, 0x10
/* 0C438C 800C992C 2806FFFF */  cmplwi  r6, 0xffff
/* 0C4390 800C9930 4082000C */  bne     lbl_800C993C
/* 0C4394 800C9934 7D6C5B78 */  mr      r12, r11
/* 0C4398 800C9938 4800000C */  b       lbl_800C9944
lbl_800C993C:
/* 0C439C 800C993C 57E60BFC */  rlwinm  r6, r31, 1, 0xf, 0x1e
/* 0C43A0 800C9940 7D68332E */  sthx    r11, r8, r6
lbl_800C9944:
/* 0C43A4 800C9944 B0070000 */  sth     r0, 0(r7)
/* 0C43A8 800C9948 3BEB0000 */  addi    r31, r11, 0
/* 0C43AC 800C994C 3884FFFF */  addi    r4, r4, -1
lbl_800C9950:
/* 0C43B0 800C9950 28040000 */  cmplwi  r4, 0
/* 0C43B4 800C9954 4082FF84 */  bne     lbl_800C98D8
/* 0C43B8 800C9958 B1680008 */  sth     r11, 8(r8)
/* 0C43BC 800C995C 7D044378 */  mr      r4, r8
/* 0C43C0 800C9960 B18900BE */  sth     r12, 0xbe(r9)
/* 0C43C4 800C9964 480000B9 */  bl      __CARDUpdateFatBlock
lbl_800C9968:
/* 0C43C8 800C9968 80010024 */  lwz     r0, 0x24(r1)
/* 0C43CC 800C996C 83E1001C */  lwz     r31, 0x1c(r1)
/* 0C43D0 800C9970 83C10018 */  lwz     r30, 0x18(r1)
/* 0C43D4 800C9974 38210020 */  addi    r1, r1, 0x20
/* 0C43D8 800C9978 7C0803A6 */  mtlr    r0
/* 0C43DC 800C997C 4E800020 */  blr     

glabel __CARDFreeBlock
/* 0C43E0 800C9980 7C0802A6 */  mflr    r0
/* 0C43E4 800C9984 1CE30110 */  mulli   r7, r3, 0x110
/* 0C43E8 800C9988 90010004 */  stw     r0, 4(r1)
/* 0C43EC 800C998C 3CC08014 */  lis     r6, __CARDBlock@ha
/* 0C43F0 800C9990 9421FFF8 */  stwu    r1, -8(r1)
/* 0C43F4 800C9994 380624D0 */  addi    r0, r6, __CARDBlock@l
/* 0C43F8 800C9998 7D203A14 */  add     r9, r0, r7
/* 0C43FC 800C999C 80090000 */  lwz     r0, 0(r9)
/* 0C4400 800C99A0 2C000000 */  cmpwi   r0, 0
/* 0C4404 800C99A4 4082000C */  bne     lbl_800C99B0
/* 0C4408 800C99A8 3860FFFD */  li      r3, -3
/* 0C440C 800C99AC 48000060 */  b       lbl_800C9A0C
lbl_800C99B0:
/* 0C4410 800C99B0 81090088 */  lwz     r8, 0x88(r9)
/* 0C4414 800C99B4 38E00000 */  li      r7, 0
/* 0C4418 800C99B8 48000040 */  b       lbl_800C99F8
lbl_800C99BC:
/* 0C441C 800C99BC 5484043E */  clrlwi  r4, r4, 0x10
/* 0C4420 800C99C0 28040005 */  cmplwi  r4, 5
/* 0C4424 800C99C4 41800010 */  blt     lbl_800C99D4
/* 0C4428 800C99C8 A0090010 */  lhz     r0, 0x10(r9)
/* 0C442C 800C99CC 7C040040 */  cmplw   r4, r0
/* 0C4430 800C99D0 4180000C */  blt     lbl_800C99DC
lbl_800C99D4:
/* 0C4434 800C99D4 3860FFFA */  li      r3, -6
/* 0C4438 800C99D8 48000034 */  b       lbl_800C9A0C
lbl_800C99DC:
/* 0C443C 800C99DC 5480083C */  slwi    r0, r4, 1
/* 0C4440 800C99E0 7CC80214 */  add     r6, r8, r0
/* 0C4444 800C99E4 A0860000 */  lhz     r4, 0(r6)
/* 0C4448 800C99E8 B0E60000 */  sth     r7, 0(r6)
/* 0C444C 800C99EC A0C80006 */  lhz     r6, 6(r8)
/* 0C4450 800C99F0 38060001 */  addi    r0, r6, 1
/* 0C4454 800C99F4 B0080006 */  sth     r0, 6(r8)
lbl_800C99F8:
/* 0C4458 800C99F8 5480043E */  clrlwi  r0, r4, 0x10
/* 0C445C 800C99FC 2800FFFF */  cmplwi  r0, 0xffff
/* 0C4460 800C9A00 4082FFBC */  bne     lbl_800C99BC
/* 0C4464 800C9A04 7D044378 */  mr      r4, r8
/* 0C4468 800C9A08 48000015 */  bl      __CARDUpdateFatBlock
lbl_800C9A0C:
/* 0C446C 800C9A0C 8001000C */  lwz     r0, 0xc(r1)
/* 0C4470 800C9A10 38210008 */  addi    r1, r1, 8
/* 0C4474 800C9A14 7C0803A6 */  mtlr    r0
/* 0C4478 800C9A18 4E800020 */  blr     

glabel __CARDUpdateFatBlock
/* 0C447C 800C9A1C 7C0802A6 */  mflr    r0
/* 0C4480 800C9A20 90010004 */  stw     r0, 4(r1)
/* 0C4484 800C9A24 9421FFD8 */  stwu    r1, -0x28(r1)
/* 0C4488 800C9A28 93E10024 */  stw     r31, 0x24(r1)
/* 0C448C 800C9A2C 93C10020 */  stw     r30, 0x20(r1)
/* 0C4490 800C9A30 3BC50000 */  addi    r30, r5, 0
/* 0C4494 800C9A34 93A1001C */  stw     r29, 0x1c(r1)
/* 0C4498 800C9A38 3BA40000 */  addi    r29, r4, 0
/* 0C449C 800C9A3C 38BD0000 */  addi    r5, r29, 0
/* 0C44A0 800C9A40 93810018 */  stw     r28, 0x18(r1)
/* 0C44A4 800C9A44 3B830000 */  addi    r28, r3, 0
/* 0C44A8 800C9A48 38DD0002 */  addi    r6, r29, 2
/* 0C44AC 800C9A4C A0640004 */  lhz     r3, 4(r4)
/* 0C44B0 800C9A50 1C9C0110 */  mulli   r4, r28, 0x110
/* 0C44B4 800C9A54 38030001 */  addi    r0, r3, 1
/* 0C44B8 800C9A58 3C608014 */  lis     r3, __CARDBlock@ha
/* 0C44BC 800C9A5C B01D0004 */  sth     r0, 4(r29)
/* 0C44C0 800C9A60 380324D0 */  addi    r0, r3, __CARDBlock@l
/* 0C44C4 800C9A64 7FE02214 */  add     r31, r0, r4
/* 0C44C8 800C9A68 387D0004 */  addi    r3, r29, 4
/* 0C44CC 800C9A6C 38801FFC */  li      r4, 0x1ffc
/* 0C44D0 800C9A70 480002BD */  bl      __CARDCheckSum
/* 0C44D4 800C9A74 387D0000 */  addi    r3, r29, 0
/* 0C44D8 800C9A78 38802000 */  li      r4, 0x2000
/* 0C44DC 800C9A7C 4BFDF7A5 */  bl      DCStoreRange
/* 0C44E0 800C9A80 93DF00D8 */  stw     r30, 0xd8(r31)
/* 0C44E4 800C9A84 3C60800D */  lis     r3, EraseCallback@ha
/* 0C44E8 800C9A88 38A397A0 */  addi    r5, r3, EraseCallback@l
/* 0C44EC 800C9A8C 801F0080 */  lwz     r0, 0x80(r31)
/* 0C44F0 800C9A90 7F83E378 */  mr      r3, r28
/* 0C44F4 800C9A94 809F000C */  lwz     r4, 0xc(r31)
/* 0C44F8 800C9A98 7C00E850 */  subf    r0, r0, r29
/* 0C44FC 800C9A9C 54009B7E */  srwi    r0, r0, 0xd
/* 0C4500 800C9AA0 7C8401D6 */  mullw   r4, r4, r0
/* 0C4504 800C9AA4 4BFFE1D9 */  bl      __CARDEraseSector
/* 0C4508 800C9AA8 8001002C */  lwz     r0, 0x2c(r1)
/* 0C450C 800C9AAC 83E10024 */  lwz     r31, 0x24(r1)
/* 0C4510 800C9AB0 83C10020 */  lwz     r30, 0x20(r1)
/* 0C4514 800C9AB4 83A1001C */  lwz     r29, 0x1c(r1)
/* 0C4518 800C9AB8 83810018 */  lwz     r28, 0x18(r1)
/* 0C451C 800C9ABC 38210028 */  addi    r1, r1, 0x28
/* 0C4520 800C9AC0 7C0803A6 */  mtlr    r0
/* 0C4524 800C9AC4 4E800020 */  blr     


