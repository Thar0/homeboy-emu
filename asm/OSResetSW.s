# OSResetSW.c
.include "macros.inc"

.section .text, "ax"

.balign 4

glabel __OSResetSWInterruptHandler
/* 0A6720 800ABCC0 7C0802A6 */  mflr    r0
/* 0A6724 800ABCC4 90010004 */  stw     r0, 4(r1)
/* 0A6728 800ABCC8 9421FFD8 */  stwu    r1, -0x28(r1)
/* 0A672C 800ABCCC 93E10024 */  stw     r31, 0x24(r1)
/* 0A6730 800ABCD0 93C10020 */  stw     r30, 0x20(r1)
/* 0A6734 800ABCD4 93A1001C */  stw     r29, 0x1c(r1)
/* 0A6738 800ABCD8 48002065 */  bl      __OSGetSystemTime
/* 0A673C 800ABCDC 3CA08000 */  lis     r5, 0x8000
/* 0A6740 800ABCE0 908D916C */  stw     r4, (HoldDown + 4)-_SDA_BASE_(r13)
/* 0A6744 800ABCE4 800500F8 */  lwz     r0, 0xf8(r5)
/* 0A6748 800ABCE8 3C80431C */  lis     r4, 0x431c
/* 0A674C 800ABCEC 3884DE83 */  addi    r4, r4, -8573
/* 0A6750 800ABCF0 906D9168 */  stw     r3, HoldDown-_SDA_BASE_(r13)
/* 0A6754 800ABCF4 5400F0BE */  srwi    r0, r0, 2
/* 0A6758 800ABCF8 7C040016 */  mulhwu  r0, r4, r0
/* 0A675C 800ABCFC 54008BFE */  srwi    r0, r0, 0xf
/* 0A6760 800ABD00 1C000064 */  mulli   r0, r0, 0x64
/* 0A6764 800ABD04 541DE8FE */  srwi    r29, r0, 3
/* 0A6768 800ABD08 3BC00000 */  li      r30, 0
/* 0A676C 800ABD0C 3FE0CC00 */  lis     r31, 0xcc00
lbl_800ABD10:
/* 0A6770 800ABD10 4800202D */  bl      __OSGetSystemTime
/* 0A6774 800ABD14 80CD916C */  lwz     r6, (HoldDown + 4)-_SDA_BASE_(r13)
/* 0A6778 800ABD18 6FC58000 */  xoris   r5, r30, 0x8000
/* 0A677C 800ABD1C 800D9168 */  lwz     r0, HoldDown-_SDA_BASE_(r13)
/* 0A6780 800ABD20 7C862010 */  subfc   r4, r6, r4
/* 0A6784 800ABD24 7C001910 */  subfe   r0, r0, r3
/* 0A6788 800ABD28 6C038000 */  xoris   r3, r0, 0x8000
/* 0A678C 800ABD2C 7C1D2010 */  subfc   r0, r29, r4
/* 0A6790 800ABD30 7CA51910 */  subfe   r5, r5, r3
/* 0A6794 800ABD34 7CA31910 */  subfe   r5, r3, r3
/* 0A6798 800ABD38 7CA500D1 */  neg.    r5, r5
/* 0A679C 800ABD3C 41820010 */  beq     lbl_800ABD4C
/* 0A67A0 800ABD40 801F3000 */  lwz     r0, 0x3000(r31)
/* 0A67A4 800ABD44 540003DF */  rlwinm. r0, r0, 0, 0xf, 0xf
/* 0A67A8 800ABD48 4182FFC8 */  beq     lbl_800ABD10
lbl_800ABD4C:
/* 0A67AC 800ABD4C 3C60CC00 */  lis     r3, 0xcc00
/* 0A67B0 800ABD50 80033000 */  lwz     r0, 0x3000(r3)
/* 0A67B4 800ABD54 540003DF */  rlwinm. r0, r0, 0, 0xf, 0xf
/* 0A67B8 800ABD58 40820034 */  bne     lbl_800ABD8C
/* 0A67BC 800ABD5C 38000001 */  li      r0, 1
/* 0A67C0 800ABD60 900D9154 */  stw     r0, Down-_SDA_BASE_(r13)
/* 0A67C4 800ABD64 38600200 */  li      r3, 0x200
/* 0A67C8 800ABD68 900D9158 */  stw     r0, LastState-_SDA_BASE_(r13)
/* 0A67CC 800ABD6C 4BFFEDCD */  bl      __OSMaskInterrupts
/* 0A67D0 800ABD70 818D9150 */  lwz     r12, ResetCallback-_SDA_BASE_(r13)
/* 0A67D4 800ABD74 280C0000 */  cmplwi  r12, 0
/* 0A67D8 800ABD78 41820014 */  beq     lbl_800ABD8C
/* 0A67DC 800ABD7C 38000000 */  li      r0, 0
/* 0A67E0 800ABD80 7D8803A6 */  mtlr    r12
/* 0A67E4 800ABD84 900D9150 */  stw     r0, ResetCallback-_SDA_BASE_(r13)
/* 0A67E8 800ABD88 4E800021 */  blrl    
lbl_800ABD8C:
/* 0A67EC 800ABD8C 38000002 */  li      r0, 2
/* 0A67F0 800ABD90 3C60CC00 */  lis     r3, 0xcc00
/* 0A67F4 800ABD94 90033000 */  stw     r0, 0x3000(r3)
/* 0A67F8 800ABD98 8001002C */  lwz     r0, 0x2c(r1)
/* 0A67FC 800ABD9C 83E10024 */  lwz     r31, 0x24(r1)
/* 0A6800 800ABDA0 83C10020 */  lwz     r30, 0x20(r1)
/* 0A6804 800ABDA4 83A1001C */  lwz     r29, 0x1c(r1)
/* 0A6808 800ABDA8 38210028 */  addi    r1, r1, 0x28
/* 0A680C 800ABDAC 7C0803A6 */  mtlr    r0
/* 0A6810 800ABDB0 4E800020 */  blr     

glabel OSGetResetButtonState
/* 0A6814 800ABDB4 7C0802A6 */  mflr    r0
/* 0A6818 800ABDB8 90010004 */  stw     r0, 4(r1)
/* 0A681C 800ABDBC 9421FFE8 */  stwu    r1, -0x18(r1)
/* 0A6820 800ABDC0 93E10014 */  stw     r31, 0x14(r1)
/* 0A6824 800ABDC4 93C10010 */  stw     r30, 0x10(r1)
/* 0A6828 800ABDC8 93A1000C */  stw     r29, 0xc(r1)
/* 0A682C 800ABDCC 4BFFE9A5 */  bl      OSDisableInterrupts
/* 0A6830 800ABDD0 7C7E1B78 */  mr      r30, r3
/* 0A6834 800ABDD4 48001F69 */  bl      __OSGetSystemTime
/* 0A6838 800ABDD8 3CA0CC00 */  lis     r5, 0xcc00
/* 0A683C 800ABDDC 80053000 */  lwz     r0, 0x3000(r5)
/* 0A6840 800ABDE0 540003DF */  rlwinm. r0, r0, 0, 0xf, 0xf
/* 0A6844 800ABDE4 408200DC */  bne     lbl_800ABEC0
/* 0A6848 800ABDE8 800D9154 */  lwz     r0, Down-_SDA_BASE_(r13)
/* 0A684C 800ABDEC 2C000000 */  cmpwi   r0, 0
/* 0A6850 800ABDF0 40820040 */  bne     lbl_800ABE30
/* 0A6854 800ABDF4 800D9160 */  lwz     r0, HoldUp-_SDA_BASE_(r13)
/* 0A6858 800ABDF8 38C00000 */  li      r6, 0
/* 0A685C 800ABDFC 80AD9164 */  lwz     r5, (HoldUp + 4)-_SDA_BASE_(r13)
/* 0A6860 800ABE00 38E00001 */  li      r7, 1
/* 0A6864 800ABE04 7C003278 */  xor     r0, r0, r6
/* 0A6868 800ABE08 7CA53278 */  xor     r5, r5, r6
/* 0A686C 800ABE0C 90ED9154 */  stw     r7, Down-_SDA_BASE_(r13)
/* 0A6870 800ABE10 7CA00379 */  or.     r0, r5, r0
/* 0A6874 800ABE14 41820008 */  beq     lbl_800ABE1C
/* 0A6878 800ABE18 48000008 */  b       lbl_800ABE20
lbl_800ABE1C:
/* 0A687C 800ABE1C 7CC73378 */  mr      r7, r6
lbl_800ABE20:
/* 0A6880 800ABE20 908D916C */  stw     r4, (HoldDown + 4)-_SDA_BASE_(r13)
/* 0A6884 800ABE24 7CFD3B78 */  mr      r29, r7
/* 0A6888 800ABE28 906D9168 */  stw     r3, HoldDown-_SDA_BASE_(r13)
/* 0A688C 800ABE2C 48000148 */  b       lbl_800ABF74
lbl_800ABE30:
/* 0A6890 800ABE30 800D9160 */  lwz     r0, HoldUp-_SDA_BASE_(r13)
/* 0A6894 800ABE34 39200000 */  li      r9, 0
/* 0A6898 800ABE38 80AD9164 */  lwz     r5, (HoldUp + 4)-_SDA_BASE_(r13)
/* 0A689C 800ABE3C 39400001 */  li      r10, 1
/* 0A68A0 800ABE40 7C004A78 */  xor     r0, r0, r9
/* 0A68A4 800ABE44 7CA54A78 */  xor     r5, r5, r9
/* 0A68A8 800ABE48 7CA00379 */  or.     r0, r5, r0
/* 0A68AC 800ABE4C 40820058 */  bne     lbl_800ABEA4
/* 0A68B0 800ABE50 3CC08000 */  lis     r6, 0x8000
/* 0A68B4 800ABE54 80AD916C */  lwz     r5, (HoldDown + 4)-_SDA_BASE_(r13)
/* 0A68B8 800ABE58 80E600F8 */  lwz     r7, 0xf8(r6)
/* 0A68BC 800ABE5C 3CC0431C */  lis     r6, 0x431c
/* 0A68C0 800ABE60 3906DE83 */  addi    r8, r6, -8573
/* 0A68C4 800ABE64 800D9168 */  lwz     r0, HoldDown-_SDA_BASE_(r13)
/* 0A68C8 800ABE68 54E6F0BE */  srwi    r6, r7, 2
/* 0A68CC 800ABE6C 7CC83016 */  mulhwu  r6, r8, r6
/* 0A68D0 800ABE70 54C68BFE */  srwi    r6, r6, 0xf
/* 0A68D4 800ABE74 1CC60064 */  mulli   r6, r6, 0x64
/* 0A68D8 800ABE78 7CE52010 */  subfc   r7, r5, r4
/* 0A68DC 800ABE7C 7C001910 */  subfe   r0, r0, r3
/* 0A68E0 800ABE80 54C8E8FE */  srwi    r8, r6, 3
/* 0A68E4 800ABE84 6C058000 */  xoris   r5, r0, 0x8000
/* 0A68E8 800ABE88 6D268000 */  xoris   r6, r9, 0x8000
/* 0A68EC 800ABE8C 7C074010 */  subfc   r0, r7, r8
/* 0A68F0 800ABE90 7CA53110 */  subfe   r5, r5, r6
/* 0A68F4 800ABE94 7CA63110 */  subfe   r5, r6, r6
/* 0A68F8 800ABE98 7CA500D1 */  neg.    r5, r5
/* 0A68FC 800ABE9C 40820008 */  bne     lbl_800ABEA4
/* 0A6900 800ABEA0 7D2A4B78 */  mr      r10, r9
lbl_800ABEA4:
/* 0A6904 800ABEA4 2C0A0000 */  cmpwi   r10, 0
/* 0A6908 800ABEA8 4182000C */  beq     lbl_800ABEB4
/* 0A690C 800ABEAC 38000001 */  li      r0, 1
/* 0A6910 800ABEB0 48000008 */  b       lbl_800ABEB8
lbl_800ABEB4:
/* 0A6914 800ABEB4 38000000 */  li      r0, 0
lbl_800ABEB8:
/* 0A6918 800ABEB8 7C1D0378 */  mr      r29, r0
/* 0A691C 800ABEBC 480000B8 */  b       lbl_800ABF74
lbl_800ABEC0:
/* 0A6920 800ABEC0 800D9154 */  lwz     r0, Down-_SDA_BASE_(r13)
/* 0A6924 800ABEC4 2C000000 */  cmpwi   r0, 0
/* 0A6928 800ABEC8 41820034 */  beq     lbl_800ABEFC
/* 0A692C 800ABECC 80AD9158 */  lwz     r5, LastState-_SDA_BASE_(r13)
/* 0A6930 800ABED0 38000000 */  li      r0, 0
/* 0A6934 800ABED4 900D9154 */  stw     r0, Down-_SDA_BASE_(r13)
/* 0A6938 800ABED8 2C050000 */  cmpwi   r5, 0
/* 0A693C 800ABEDC 3BA50000 */  addi    r29, r5, 0
/* 0A6940 800ABEE0 41820010 */  beq     lbl_800ABEF0
/* 0A6944 800ABEE4 908D9164 */  stw     r4, (HoldUp + 4)-_SDA_BASE_(r13)
/* 0A6948 800ABEE8 906D9160 */  stw     r3, HoldUp-_SDA_BASE_(r13)
/* 0A694C 800ABEEC 48000088 */  b       lbl_800ABF74
lbl_800ABEF0:
/* 0A6950 800ABEF0 900D9164 */  stw     r0, (HoldUp + 4)-_SDA_BASE_(r13)
/* 0A6954 800ABEF4 900D9160 */  stw     r0, HoldUp-_SDA_BASE_(r13)
/* 0A6958 800ABEF8 4800007C */  b       lbl_800ABF74
lbl_800ABEFC:
/* 0A695C 800ABEFC 80CD9160 */  lwz     r6, HoldUp-_SDA_BASE_(r13)
/* 0A6960 800ABF00 39000000 */  li      r8, 0
/* 0A6964 800ABF04 80ED9164 */  lwz     r7, (HoldUp + 4)-_SDA_BASE_(r13)
/* 0A6968 800ABF08 7CC04278 */  xor     r0, r6, r8
/* 0A696C 800ABF0C 7CE54278 */  xor     r5, r7, r8
/* 0A6970 800ABF10 7CA00379 */  or.     r0, r5, r0
/* 0A6974 800ABF14 41820050 */  beq     lbl_800ABF64
/* 0A6978 800ABF18 3CA08000 */  lis     r5, 0x8000
/* 0A697C 800ABF1C 800500F8 */  lwz     r0, 0xf8(r5)
/* 0A6980 800ABF20 3CA01062 */  lis     r5, 0x1062
/* 0A6984 800ABF24 38A54DD3 */  addi    r5, r5, 0x4dd3
/* 0A6988 800ABF28 5400F0BE */  srwi    r0, r0, 2
/* 0A698C 800ABF2C 7C050016 */  mulhwu  r0, r5, r0
/* 0A6990 800ABF30 5400D1BE */  srwi    r0, r0, 6
/* 0A6994 800ABF34 1C000028 */  mulli   r0, r0, 0x28
/* 0A6998 800ABF38 7CE72010 */  subfc   r7, r7, r4
/* 0A699C 800ABF3C 7CA61910 */  subfe   r5, r6, r3
/* 0A69A0 800ABF40 6CA68000 */  xoris   r6, r5, 0x8000
/* 0A69A4 800ABF44 6D058000 */  xoris   r5, r8, 0x8000
/* 0A69A8 800ABF48 7C003810 */  subfc   r0, r0, r7
/* 0A69AC 800ABF4C 7CA53110 */  subfe   r5, r5, r6
/* 0A69B0 800ABF50 7CA63110 */  subfe   r5, r6, r6
/* 0A69B4 800ABF54 7CA500D1 */  neg.    r5, r5
/* 0A69B8 800ABF58 4182000C */  beq     lbl_800ABF64
/* 0A69BC 800ABF5C 3BA00001 */  li      r29, 1
/* 0A69C0 800ABF60 48000014 */  b       lbl_800ABF74
lbl_800ABF64:
/* 0A69C4 800ABF64 38000000 */  li      r0, 0
/* 0A69C8 800ABF68 900D9164 */  stw     r0, (HoldUp + 4)-_SDA_BASE_(r13)
/* 0A69CC 800ABF6C 3BA00000 */  li      r29, 0
/* 0A69D0 800ABF70 900D9160 */  stw     r0, HoldUp-_SDA_BASE_(r13)
lbl_800ABF74:
/* 0A69D4 800ABF74 3CA08000 */  lis     r5, 0x8000
/* 0A69D8 800ABF78 93AD9158 */  stw     r29, LastState-_SDA_BASE_(r13)
/* 0A69DC 800ABF7C 880530E3 */  lbz     r0, 0x30e3(r5)
/* 0A69E0 800ABF80 540006FF */  clrlwi. r0, r0, 0x1b
/* 0A69E4 800ABF84 418200A0 */  beq     lbl_800AC024
/* 0A69E8 800ABF88 1D40003C */  mulli   r10, r0, 0x3c
/* 0A69EC 800ABF8C 800500F8 */  lwz     r0, 0xf8(r5)
/* 0A69F0 800ABF90 812D90F4 */  lwz     r9, (__OSStartTime + 4)-_SDA_BASE_(r13)
/* 0A69F4 800ABF94 810D90F0 */  lwz     r8, __OSStartTime-_SDA_BASE_(r13)
/* 0A69F8 800ABF98 5406F0BE */  srwi    r6, r0, 2
/* 0A69FC 800ABF9C 7D40FE70 */  srawi   r0, r10, 0x1f
/* 0A6A00 800ABFA0 7CE031D6 */  mullw   r7, r0, r6
/* 0A6A04 800ABFA4 7C0A3016 */  mulhwu  r0, r10, r6
/* 0A6A08 800ABFA8 7CAA31D6 */  mullw   r5, r10, r6
/* 0A6A0C 800ABFAC 7D292814 */  addc    r9, r9, r5
/* 0A6A10 800ABFB0 3BE00000 */  li      r31, 0
/* 0A6A14 800ABFB4 7CE70214 */  add     r7, r7, r0
/* 0A6A18 800ABFB8 7C0AF9D6 */  mullw   r0, r10, r31
/* 0A6A1C 800ABFBC 7C070214 */  add     r0, r7, r0
/* 0A6A20 800ABFC0 7D080114 */  adde    r8, r8, r0
/* 0A6A24 800ABFC4 6D078000 */  xoris   r7, r8, 0x8000
/* 0A6A28 800ABFC8 6C658000 */  xoris   r5, r3, 0x8000
/* 0A6A2C 800ABFCC 7C044810 */  subfc   r0, r4, r9
/* 0A6A30 800ABFD0 7CA53910 */  subfe   r5, r5, r7
/* 0A6A34 800ABFD4 7CA73910 */  subfe   r5, r7, r7
/* 0A6A38 800ABFD8 7CA500D1 */  neg.    r5, r5
/* 0A6A3C 800ABFDC 41820048 */  beq     lbl_800AC024
/* 0A6A40 800ABFE0 7C892010 */  subfc   r4, r9, r4
/* 0A6A44 800ABFE4 7C681910 */  subfe   r3, r8, r3
/* 0A6A48 800ABFE8 38A00000 */  li      r5, 0
/* 0A6A4C 800ABFEC 4802DBBD */  bl      __div2i
/* 0A6A50 800ABFF0 38A00000 */  li      r5, 0
/* 0A6A54 800ABFF4 38C00002 */  li      r6, 2
/* 0A6A58 800ABFF8 4802DBB1 */  bl      __div2i
/* 0A6A5C 800ABFFC 38000001 */  li      r0, 1
/* 0A6A60 800AC000 7C840038 */  and     r4, r4, r0
/* 0A6A64 800AC004 7C60F838 */  and     r0, r3, r31
/* 0A6A68 800AC008 7C83FA78 */  xor     r3, r4, r31
/* 0A6A6C 800AC00C 7C00FA78 */  xor     r0, r0, r31
/* 0A6A70 800AC010 7C600379 */  or.     r0, r3, r0
/* 0A6A74 800AC014 4082000C */  bne     lbl_800AC020
/* 0A6A78 800AC018 3BA00001 */  li      r29, 1
/* 0A6A7C 800AC01C 48000008 */  b       lbl_800AC024
lbl_800AC020:
/* 0A6A80 800AC020 3BA00000 */  li      r29, 0
lbl_800AC024:
/* 0A6A84 800AC024 7FC3F378 */  mr      r3, r30
/* 0A6A88 800AC028 4BFFE771 */  bl      OSRestoreInterrupts
/* 0A6A8C 800AC02C 7FA3EB78 */  mr      r3, r29
/* 0A6A90 800AC030 8001001C */  lwz     r0, 0x1c(r1)
/* 0A6A94 800AC034 83E10014 */  lwz     r31, 0x14(r1)
/* 0A6A98 800AC038 83C10010 */  lwz     r30, 0x10(r1)
/* 0A6A9C 800AC03C 83A1000C */  lwz     r29, 0xc(r1)
/* 0A6AA0 800AC040 38210018 */  addi    r1, r1, 0x18
/* 0A6AA4 800AC044 7C0803A6 */  mtlr    r0
/* 0A6AA8 800AC048 4E800020 */  blr     


.section .sbss, "wa"

.balign 8

/* 00100390 80145B30 0004 */
ResetCallback:
    .skip 4

.balign 4

/* 00100394 80145B34 0004 */
Down:
    .skip 4

.balign 4

/* 00100398 80145B38 0004 */
LastState:
    .skip 4

.balign 8

/* 001003A0 80145B40 0008 */
HoldUp:
    .skip 8

.balign 8

/* 001003A8 80145B48 0008 */
HoldDown:
    .skip 8


