# OSReboot.c
.include "macros.inc"

.section .text, "ax"

.balign 4

Run:
/* 0A5FA0 800AB540 7C0004AC */  sync	0
/* 0A5FA4 800AB544 4C00012C */  isync	
/* 0A5FA8 800AB548 7C6803A6 */  mtlr	r3
/* 0A5FAC 800AB54C 4E800020 */  blr		

Callback:
/* 0A5FB0 800AB550 38000001 */  li		r0, 1
/* 0A5FB4 800AB554 900D9138 */  stw		r0, Prepared-_SDA_BASE_(r13)
/* 0A5FB8 800AB558 4E800020 */  blr		

glabel __OSReboot
/* 0A5FBC 800AB55C 7C0802A6 */  mflr	r0
/* 0A5FC0 800AB560 90010004 */  stw		r0, 4(r1)
/* 0A5FC4 800AB564 9421FC80 */  stwu	r1, -0x380(r1)
/* 0A5FC8 800AB568 BF410368 */  stmw	r26, 0x368(r1)
/* 0A5FCC 800AB56C 3C608014 */  lis		r3, Header@ha
/* 0A5FD0 800AB570 3BC30CC0 */  addi	r30, r3, Header@l
/* 0A5FD4 800AB574 4BFFF1FD */  bl		OSDisableInterrupts
/* 0A5FD8 800AB578 80AD9130 */  lwz		r5, SaveStart-_SDA_BASE_(r13)
/* 0A5FDC 800AB57C 3C808130 */  lis		r4, 0x8130
/* 0A5FE0 800AB580 800D9134 */  lwz		r0, SaveEnd-_SDA_BASE_(r13)
/* 0A5FE4 800AB584 3B600000 */  li		r27, 0
/* 0A5FE8 800AB588 3FE08180 */  lis		r31, 0x8180
/* 0A5FEC 800AB58C 38C00001 */  li		r6, 1
/* 0A5FF0 800AB590 937FFFFC */  stw		r27, -4(r31)
/* 0A5FF4 800AB594 3F408000 */  lis		r26, 0x8000
/* 0A5FF8 800AB598 937FFFF8 */  stw		r27, -8(r31)
/* 0A5FFC 800AB59C 386100A0 */  addi	r3, r1, 0xa0
/* 0A6000 800AB5A0 98DA30E2 */  stb		r6, 0x30e2(r26)
/* 0A6004 800AB5A4 90A4DFF0 */  stw		r5, -0x2010(r4)
/* 0A6008 800AB5A8 9004DFEC */  stw		r0, -0x2014(r4)
/* 0A600C 800AB5AC 4BFFE66D */  bl		OSClearContext
/* 0A6010 800AB5B0 386100A0 */  addi	r3, r1, 0xa0
/* 0A6014 800AB5B4 4BFFE49D */  bl		OSSetCurrentContext
/* 0A6018 800AB5B8 480136BD */  bl		DVDInit
/* 0A601C 800AB5BC 38600001 */  li		r3, 1
/* 0A6020 800AB5C0 48015C71 */  bl		DVDSetAutoInvalidation
/* 0A6024 800AB5C4 48015C7D */  bl		DVDResume
/* 0A6028 800AB5C8 3C60800B */  lis		r3, Callback@ha
/* 0A602C 800AB5CC 936D9138 */  stw		r27, Prepared-_SDA_BASE_(r13)
/* 0A6030 800AB5D0 3863B550 */  addi	r3, r3, Callback@l
/* 0A6034 800AB5D4 48016109 */  bl		__DVDPrepareResetAsync
/* 0A6038 800AB5D8 3860FFE0 */  li		r3, -32
/* 0A603C 800AB5DC 4BFFF55D */  bl		__OSMaskInterrupts
/* 0A6040 800AB5E0 38600400 */  li		r3, 0x400
/* 0A6044 800AB5E4 4BFFF5DD */  bl		__OSUnmaskInterrupts
/* 0A6048 800AB5E8 4BFFF19D */  bl		OSEnableInterrupts
/* 0A604C 800AB5EC 48002731 */  bl		OSGetTime
/* 0A6050 800AB5F0 7C9D2378 */  mr		r29, r4
/* 0A6054 800AB5F4 7C7C1B78 */  mr		r28, r3
/* 0A6058 800AB5F8 48000004 */  b		lbl_800AB5FC
lbl_800AB5FC:
/* 0A605C 800AB5FC 801A00F8 */  lwz		r0, 0xf8(r26)
/* 0A6060 800AB600 6F7A8000 */  xoris	r26, r27, 0x8000
/* 0A6064 800AB604 541BF0BE */  srwi	r27, r0, 2
/* 0A6068 800AB608 48000004 */  b		lbl_800AB60C
lbl_800AB60C:
/* 0A606C 800AB60C 48000040 */  b		lbl_800AB64C
lbl_800AB610:
/* 0A6070 800AB610 48015FD5 */  bl		DVDCheckDisk
/* 0A6074 800AB614 2C030000 */  cmpwi	r3, 0
/* 0A6078 800AB618 4182002C */  beq		lbl_800AB644
/* 0A607C 800AB61C 48002701 */  bl		OSGetTime
/* 0A6080 800AB620 7C9D2010 */  subfc	r4, r29, r4
/* 0A6084 800AB624 7C1C1910 */  subfe	r0, r28, r3
/* 0A6088 800AB628 6C038000 */  xoris	r3, r0, 0x8000
/* 0A608C 800AB62C 7C04D810 */  subfc	r0, r4, r27
/* 0A6090 800AB630 7C63D110 */  subfe	r3, r3, r26
/* 0A6094 800AB634 7C7AD110 */  subfe	r3, r26, r26
/* 0A6098 800AB638 7C6300D0 */  neg		r3, r3
/* 0A609C 800AB63C 2C030000 */  cmpwi	r3, 0
/* 0A60A0 800AB640 4182000C */  beq		lbl_800AB64C
lbl_800AB644:
/* 0A60A4 800AB644 807FFFFC */  lwz		r3, -4(r31)
/* 0A60A8 800AB648 48000349 */  bl		__OSDoHotReset
lbl_800AB64C:
/* 0A60AC 800AB64C 800D9138 */  lwz		r0, Prepared-_SDA_BASE_(r13)
/* 0A60B0 800AB650 2C000001 */  cmpwi	r0, 1
/* 0A60B4 800AB654 4082FFBC */  bne		lbl_800AB610
/* 0A60B8 800AB658 800D90C4 */  lwz		r0, __OSIsGcam-_SDA_BASE_(r13)
/* 0A60BC 800AB65C 2C000000 */  cmpwi	r0, 0
/* 0A60C0 800AB660 408200C8 */  bne		lbl_800AB728
/* 0A60C4 800AB664 48015F79 */  bl		DVDGetCurrentDiskID
/* 0A60C8 800AB668 88030008 */  lbz		r0, 8(r3)
/* 0A60CC 800AB66C 28000000 */  cmplwi	r0, 0
/* 0A60D0 800AB670 4182000C */  beq		lbl_800AB67C
/* 0A60D4 800AB674 38000001 */  li		r0, 1
/* 0A60D8 800AB678 48000008 */  b		lbl_800AB680
lbl_800AB67C:
/* 0A60DC 800AB67C 38000000 */  li		r0, 0
lbl_800AB680:
/* 0A60E0 800AB680 2C000000 */  cmpwi	r0, 0
/* 0A60E4 800AB684 418200A4 */  beq		lbl_800AB728
/* 0A60E8 800AB688 38600000 */  li		r3, 0
/* 0A60EC 800AB68C 48018E7D */  bl		AISetStreamVolLeft
/* 0A60F0 800AB690 38600000 */  li		r3, 0
/* 0A60F4 800AB694 48018EA1 */  bl		AISetStreamVolRight
/* 0A60F8 800AB698 38610070 */  addi	r3, r1, 0x70
/* 0A60FC 800AB69C 38800000 */  li		r4, 0
/* 0A6100 800AB6A0 48015689 */  bl		DVDCancelStreamAsync
/* 0A6104 800AB6A4 48002679 */  bl		OSGetTime
/* 0A6108 800AB6A8 7C9F2378 */  mr		r31, r4
/* 0A610C 800AB6AC 7C7D1B78 */  mr		r29, r3
/* 0A6110 800AB6B0 48000004 */  b		lbl_800AB6B4
lbl_800AB6B4:
/* 0A6114 800AB6B4 3C608000 */  lis		r3, 0x8000
/* 0A6118 800AB6B8 806300F8 */  lwz		r3, 0xf8(r3)
/* 0A611C 800AB6BC 38000000 */  li		r0, 0
/* 0A6120 800AB6C0 6C1B8000 */  xoris	r27, r0, 0x8000
/* 0A6124 800AB6C4 547CF0BE */  srwi	r28, r3, 2
/* 0A6128 800AB6C8 3F408180 */  lis		r26, 0x8180
/* 0A612C 800AB6CC 48000004 */  b		lbl_800AB6D0
lbl_800AB6D0:
/* 0A6130 800AB6D0 48000040 */  b		lbl_800AB710
lbl_800AB6D4:
/* 0A6134 800AB6D4 48015F11 */  bl		DVDCheckDisk
/* 0A6138 800AB6D8 2C030000 */  cmpwi	r3, 0
/* 0A613C 800AB6DC 4182002C */  beq		lbl_800AB708
/* 0A6140 800AB6E0 4800263D */  bl		OSGetTime
/* 0A6144 800AB6E4 7C9F2010 */  subfc	r4, r31, r4
/* 0A6148 800AB6E8 7C1D1910 */  subfe	r0, r29, r3
/* 0A614C 800AB6EC 6C038000 */  xoris	r3, r0, 0x8000
/* 0A6150 800AB6F0 7C04E010 */  subfc	r0, r4, r28
/* 0A6154 800AB6F4 7C63D910 */  subfe	r3, r3, r27
/* 0A6158 800AB6F8 7C7BD910 */  subfe	r3, r27, r27
/* 0A615C 800AB6FC 7C6300D0 */  neg		r3, r3
/* 0A6160 800AB700 2C030000 */  cmpwi	r3, 0
/* 0A6164 800AB704 4182000C */  beq		lbl_800AB710
lbl_800AB708:
/* 0A6168 800AB708 807AFFFC */  lwz		r3, -4(r26)
/* 0A616C 800AB70C 48000285 */  bl		__OSDoHotReset
lbl_800AB710:
/* 0A6170 800AB710 38610070 */  addi	r3, r1, 0x70
/* 0A6174 800AB714 48015A25 */  bl		DVDGetCommandBlockStatus
/* 0A6178 800AB718 2C030000 */  cmpwi	r3, 0
/* 0A617C 800AB71C 4082FFB8 */  bne		lbl_800AB6D4
/* 0A6180 800AB720 38600000 */  li		r3, 0
/* 0A6184 800AB724 48018B25 */  bl		AISetStreamPlayState
lbl_800AB728:
/* 0A6188 800AB728 7FC4F378 */  mr		r4, r30
/* 0A618C 800AB72C 38610040 */  addi	r3, r1, 0x40
/* 0A6190 800AB730 38A00020 */  li		r5, 0x20
/* 0A6194 800AB734 38C02440 */  li		r6, 0x2440
/* 0A6198 800AB738 38E00000 */  li		r7, 0
/* 0A619C 800AB73C 39000000 */  li		r8, 0
/* 0A61A0 800AB740 480151D9 */  bl		DVDReadAbsAsyncPrio
/* 0A61A4 800AB744 480025D9 */  bl		OSGetTime
/* 0A61A8 800AB748 7C9A2378 */  mr		r26, r4
/* 0A61AC 800AB74C 7C7F1B78 */  mr		r31, r3
/* 0A61B0 800AB750 48000004 */  b		lbl_800AB754
lbl_800AB754:
/* 0A61B4 800AB754 3C608000 */  lis		r3, 0x8000
/* 0A61B8 800AB758 806300F8 */  lwz		r3, 0xf8(r3)
/* 0A61BC 800AB75C 38000000 */  li		r0, 0
/* 0A61C0 800AB760 6C1C8000 */  xoris	r28, r0, 0x8000
/* 0A61C4 800AB764 547DF0BE */  srwi	r29, r3, 2
/* 0A61C8 800AB768 3F608180 */  lis		r27, 0x8180
/* 0A61CC 800AB76C 48000004 */  b		lbl_800AB770
lbl_800AB770:
/* 0A61D0 800AB770 48000040 */  b		lbl_800AB7B0
lbl_800AB774:
/* 0A61D4 800AB774 48015E71 */  bl		DVDCheckDisk
/* 0A61D8 800AB778 2C030000 */  cmpwi	r3, 0
/* 0A61DC 800AB77C 4182002C */  beq		lbl_800AB7A8
/* 0A61E0 800AB780 4800259D */  bl		OSGetTime
/* 0A61E4 800AB784 7C9A2010 */  subfc	r4, r26, r4
/* 0A61E8 800AB788 7C1F1910 */  subfe	r0, r31, r3
/* 0A61EC 800AB78C 6C038000 */  xoris	r3, r0, 0x8000
/* 0A61F0 800AB790 7C04E810 */  subfc	r0, r4, r29
/* 0A61F4 800AB794 7C63E110 */  subfe	r3, r3, r28
/* 0A61F8 800AB798 7C7CE110 */  subfe	r3, r28, r28
/* 0A61FC 800AB79C 7C6300D0 */  neg		r3, r3
/* 0A6200 800AB7A0 2C030000 */  cmpwi	r3, 0
/* 0A6204 800AB7A4 4182000C */  beq		lbl_800AB7B0
lbl_800AB7A8:
/* 0A6208 800AB7A8 807BFFFC */  lwz		r3, -4(r27)
/* 0A620C 800AB7AC 480001E5 */  bl		__OSDoHotReset
lbl_800AB7B0:
/* 0A6210 800AB7B0 38610040 */  addi	r3, r1, 0x40
/* 0A6214 800AB7B4 48015985 */  bl		DVDGetCommandBlockStatus
/* 0A6218 800AB7B8 2C030000 */  cmpwi	r3, 0
/* 0A621C 800AB7BC 4082FFB8 */  bne		lbl_800AB774
/* 0A6220 800AB7C0 80BE0018 */  lwz		r5, 0x18(r30)
/* 0A6224 800AB7C4 38610010 */  addi	r3, r1, 0x10
/* 0A6228 800AB7C8 80DE0014 */  lwz		r6, 0x14(r30)
/* 0A622C 800AB7CC 3C808130 */  lis		r4, 0x8130
/* 0A6230 800AB7D0 3805001F */  addi	r0, r5, 0x1f
/* 0A6234 800AB7D4 38C60020 */  addi	r6, r6, 0x20
/* 0A6238 800AB7D8 541A0034 */  rlwinm	r26, r0, 0, 0, 0x1a
/* 0A623C 800AB7DC 7F45D378 */  mr		r5, r26
/* 0A6240 800AB7E0 38C62440 */  addi	r6, r6, 0x2440
/* 0A6244 800AB7E4 38E00000 */  li		r7, 0
/* 0A6248 800AB7E8 39000000 */  li		r8, 0
/* 0A624C 800AB7EC 4801512D */  bl		DVDReadAbsAsyncPrio
/* 0A6250 800AB7F0 4800252D */  bl		OSGetTime
/* 0A6254 800AB7F4 7C9B2378 */  mr		r27, r4
/* 0A6258 800AB7F8 7C7C1B78 */  mr		r28, r3
/* 0A625C 800AB7FC 48000004 */  b		lbl_800AB800
lbl_800AB800:
/* 0A6260 800AB800 3C608000 */  lis		r3, 0x8000
/* 0A6264 800AB804 806300F8 */  lwz		r3, 0xf8(r3)
/* 0A6268 800AB808 38000000 */  li		r0, 0
/* 0A626C 800AB80C 6C1F8000 */  xoris	r31, r0, 0x8000
/* 0A6270 800AB810 547DF0BE */  srwi	r29, r3, 2
/* 0A6274 800AB814 3FC08180 */  lis		r30, 0x8180
/* 0A6278 800AB818 48000004 */  b		lbl_800AB81C
lbl_800AB81C:
/* 0A627C 800AB81C 48000040 */  b		lbl_800AB85C
lbl_800AB820:
/* 0A6280 800AB820 48015DC5 */  bl		DVDCheckDisk
/* 0A6284 800AB824 2C030000 */  cmpwi	r3, 0
/* 0A6288 800AB828 4182002C */  beq		lbl_800AB854
/* 0A628C 800AB82C 480024F1 */  bl		OSGetTime
/* 0A6290 800AB830 7C9B2010 */  subfc	r4, r27, r4
/* 0A6294 800AB834 7C1C1910 */  subfe	r0, r28, r3
/* 0A6298 800AB838 6C038000 */  xoris	r3, r0, 0x8000
/* 0A629C 800AB83C 7C04E810 */  subfc	r0, r4, r29
/* 0A62A0 800AB840 7C63F910 */  subfe	r3, r3, r31
/* 0A62A4 800AB844 7C7FF910 */  subfe	r3, r31, r31
/* 0A62A8 800AB848 7C6300D0 */  neg		r3, r3
/* 0A62AC 800AB84C 2C030000 */  cmpwi	r3, 0
/* 0A62B0 800AB850 4182000C */  beq		lbl_800AB85C
lbl_800AB854:
/* 0A62B4 800AB854 807EFFFC */  lwz		r3, -4(r30)
/* 0A62B8 800AB858 48000139 */  bl		__OSDoHotReset
lbl_800AB85C:
/* 0A62BC 800AB85C 38610010 */  addi	r3, r1, 0x10
/* 0A62C0 800AB860 480158D9 */  bl		DVDGetCommandBlockStatus
/* 0A62C4 800AB864 2C030000 */  cmpwi	r3, 0
/* 0A62C8 800AB868 4082FFB8 */  bne		lbl_800AB820
/* 0A62CC 800AB86C 3C608130 */  lis		r3, 0x8130
/* 0A62D0 800AB870 7F44D378 */  mr		r4, r26
/* 0A62D4 800AB874 4BFFDA35 */  bl		ICInvalidateRange
/* 0A62D8 800AB878 4BFFEEF9 */  bl		OSDisableInterrupts
/* 0A62DC 800AB87C 4BFFDA61 */  bl		ICFlashInvalidate
/* 0A62E0 800AB880 3C608130 */  lis		r3, 0x8130
/* 0A62E4 800AB884 4BFFFCBD */  bl		Run
/* 0A62E8 800AB888 BB410368 */  lmw		r26, 0x368(r1)
/* 0A62EC 800AB88C 80010384 */  lwz		r0, 0x384(r1)
/* 0A62F0 800AB890 38210380 */  addi	r1, r1, 0x380
/* 0A62F4 800AB894 7C0803A6 */  mtlr	r0
/* 0A62F8 800AB898 4E800020 */  blr		


.section .bss, "wa"

.balign 32

/* 0013DD40 80140CC0 0020 */
Header:
    .skip 32


.section .sbss, "wa"

.balign 8

/* 00100370 80145B10 0004 */
SaveStart:
    .skip 4

.balign 4

/* 00100374 80145B14 0004 */
SaveEnd:
    .skip 4

.balign 4

/* 00100378 80145B18 0004 */
Prepared:
    .skip 4


