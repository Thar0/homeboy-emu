# CARDDir.c
.include "macros.inc"

.section .text, "ax"

.balign 4

glabel __CARDGetDirBlock
/* 0C4528 800C9AC8 80630084 */  lwz		r3, 0x84(r3)
/* 0C452C 800C9ACC 4E800020 */  blr		

WriteCallback:
/* 0C4530 800C9AD0 7C0802A6 */  mflr	r0
/* 0C4534 800C9AD4 90010004 */  stw		r0, 4(r1)
/* 0C4538 800C9AD8 9421FFE0 */  stwu	r1, -0x20(r1)
/* 0C453C 800C9ADC 93E1001C */  stw		r31, 0x1c(r1)
/* 0C4540 800C9AE0 93C10018 */  stw		r30, 0x18(r1)
/* 0C4544 800C9AE4 7C9E2379 */  or.		r30, r4, r4
/* 0C4548 800C9AE8 93A10014 */  stw		r29, 0x14(r1)
/* 0C454C 800C9AEC 3BA30000 */  addi	r29, r3, 0
/* 0C4550 800C9AF0 1CBD0110 */  mulli	r5, r29, 0x110
/* 0C4554 800C9AF4 3C608014 */  lis		r3, __CARDBlock@ha
/* 0C4558 800C9AF8 380324D0 */  addi	r0, r3, __CARDBlock@l
/* 0C455C 800C9AFC 7FE02A14 */  add		r31, r0, r5
/* 0C4560 800C9B00 41800044 */  blt		lbl_800C9B44
/* 0C4564 800C9B04 807F0080 */  lwz		r3, 0x80(r31)
/* 0C4568 800C9B08 801F0084 */  lwz		r0, 0x84(r31)
/* 0C456C 800C9B0C 38832000 */  addi	r4, r3, 0x2000
/* 0C4570 800C9B10 7C002040 */  cmplw	r0, r4
/* 0C4574 800C9B14 38034000 */  addi	r0, r3, 0x4000
/* 0C4578 800C9B18 40820018 */  bne		lbl_800C9B30
/* 0C457C 800C9B1C 901F0084 */  stw		r0, 0x84(r31)
/* 0C4580 800C9B20 7C030378 */  mr		r3, r0
/* 0C4584 800C9B24 38A02000 */  li		r5, 0x2000
/* 0C4588 800C9B28 4BF3B99D */  bl		memcpy
/* 0C458C 800C9B2C 48000018 */  b		lbl_800C9B44
lbl_800C9B30:
/* 0C4590 800C9B30 909F0084 */  stw		r4, 0x84(r31)
/* 0C4594 800C9B34 38640000 */  addi	r3, r4, 0
/* 0C4598 800C9B38 7C040378 */  mr		r4, r0
/* 0C459C 800C9B3C 38A02000 */  li		r5, 0x2000
/* 0C45A0 800C9B40 4BF3B985 */  bl		memcpy
lbl_800C9B44:
/* 0C45A4 800C9B44 801F00D0 */  lwz		r0, 0xd0(r31)
/* 0C45A8 800C9B48 28000000 */  cmplwi	r0, 0
/* 0C45AC 800C9B4C 40820010 */  bne		lbl_800C9B5C
/* 0C45B0 800C9B50 387F0000 */  addi	r3, r31, 0
/* 0C45B4 800C9B54 389E0000 */  addi	r4, r30, 0
/* 0C45B8 800C9B58 4BFFE3A9 */  bl		__CARDPutControlBlock
lbl_800C9B5C:
/* 0C45BC 800C9B5C 801F00D8 */  lwz		r0, 0xd8(r31)
/* 0C45C0 800C9B60 28000000 */  cmplwi	r0, 0
/* 0C45C4 800C9B64 7C0C0378 */  mr		r12, r0
/* 0C45C8 800C9B68 4182001C */  beq		lbl_800C9B84
/* 0C45CC 800C9B6C 38000000 */  li		r0, 0
/* 0C45D0 800C9B70 7D8803A6 */  mtlr	r12
/* 0C45D4 800C9B74 901F00D8 */  stw		r0, 0xd8(r31)
/* 0C45D8 800C9B78 387D0000 */  addi	r3, r29, 0
/* 0C45DC 800C9B7C 389E0000 */  addi	r4, r30, 0
/* 0C45E0 800C9B80 4E800021 */  blrl	
lbl_800C9B84:
/* 0C45E4 800C9B84 80010024 */  lwz		r0, 0x24(r1)
/* 0C45E8 800C9B88 83E1001C */  lwz		r31, 0x1c(r1)
/* 0C45EC 800C9B8C 83C10018 */  lwz		r30, 0x18(r1)
/* 0C45F0 800C9B90 83A10014 */  lwz		r29, 0x14(r1)
/* 0C45F4 800C9B94 38210020 */  addi	r1, r1, 0x20
/* 0C45F8 800C9B98 7C0803A6 */  mtlr	r0
/* 0C45FC 800C9B9C 4E800020 */  blr		

EraseCallback:
/* 0C4600 800C9BA0 7C0802A6 */  mflr	r0
/* 0C4604 800C9BA4 90010004 */  stw		r0, 4(r1)
/* 0C4608 800C9BA8 9421FFD8 */  stwu	r1, -0x28(r1)
/* 0C460C 800C9BAC 93E10024 */  stw		r31, 0x24(r1)
/* 0C4610 800C9BB0 3BE30000 */  addi	r31, r3, 0
/* 0C4614 800C9BB4 3C608014 */  lis		r3, __CARDBlock@ha
/* 0C4618 800C9BB8 93C10020 */  stw		r30, 0x20(r1)
/* 0C461C 800C9BBC 1CBF0110 */  mulli	r5, r31, 0x110
/* 0C4620 800C9BC0 93A1001C */  stw		r29, 0x1c(r1)
/* 0C4624 800C9BC4 380324D0 */  addi	r0, r3, __CARDBlock@l
/* 0C4628 800C9BC8 7C9D2379 */  or.		r29, r4, r4
/* 0C462C 800C9BCC 7FC02A14 */  add		r30, r0, r5
/* 0C4630 800C9BD0 4180003C */  blt		lbl_800C9C0C
/* 0C4634 800C9BD4 80BE0084 */  lwz		r5, 0x84(r30)
/* 0C4638 800C9BD8 3C60800D */  lis		r3, WriteCallback@ha
/* 0C463C 800C9BDC 801E0080 */  lwz		r0, 0x80(r30)
/* 0C4640 800C9BE0 38E39AD0 */  addi	r7, r3, WriteCallback@l
/* 0C4644 800C9BE4 807E000C */  lwz		r3, 0xc(r30)
/* 0C4648 800C9BE8 7C002850 */  subf	r0, r0, r5
/* 0C464C 800C9BEC 54009B7E */  srwi	r0, r0, 0xd
/* 0C4650 800C9BF0 7C8301D6 */  mullw	r4, r3, r0
/* 0C4654 800C9BF4 38C50000 */  addi	r6, r5, 0
/* 0C4658 800C9BF8 387F0000 */  addi	r3, r31, 0
/* 0C465C 800C9BFC 38A02000 */  li		r5, 0x2000
/* 0C4660 800C9C00 4BFFFA49 */  bl		__CARDWrite
/* 0C4664 800C9C04 7C7D1B79 */  or.		r29, r3, r3
/* 0C4668 800C9C08 40800044 */  bge		lbl_800C9C4C
lbl_800C9C0C:
/* 0C466C 800C9C0C 801E00D0 */  lwz		r0, 0xd0(r30)
/* 0C4670 800C9C10 28000000 */  cmplwi	r0, 0
/* 0C4674 800C9C14 40820010 */  bne		lbl_800C9C24
/* 0C4678 800C9C18 387E0000 */  addi	r3, r30, 0
/* 0C467C 800C9C1C 389D0000 */  addi	r4, r29, 0
/* 0C4680 800C9C20 4BFFE2E1 */  bl		__CARDPutControlBlock
lbl_800C9C24:
/* 0C4684 800C9C24 801E00D8 */  lwz		r0, 0xd8(r30)
/* 0C4688 800C9C28 28000000 */  cmplwi	r0, 0
/* 0C468C 800C9C2C 7C0C0378 */  mr		r12, r0
/* 0C4690 800C9C30 4182001C */  beq		lbl_800C9C4C
/* 0C4694 800C9C34 38000000 */  li		r0, 0
/* 0C4698 800C9C38 7D8803A6 */  mtlr	r12
/* 0C469C 800C9C3C 901E00D8 */  stw		r0, 0xd8(r30)
/* 0C46A0 800C9C40 387F0000 */  addi	r3, r31, 0
/* 0C46A4 800C9C44 389D0000 */  addi	r4, r29, 0
/* 0C46A8 800C9C48 4E800021 */  blrl	
lbl_800C9C4C:
/* 0C46AC 800C9C4C 8001002C */  lwz		r0, 0x2c(r1)
/* 0C46B0 800C9C50 83E10024 */  lwz		r31, 0x24(r1)
/* 0C46B4 800C9C54 83C10020 */  lwz		r30, 0x20(r1)
/* 0C46B8 800C9C58 83A1001C */  lwz		r29, 0x1c(r1)
/* 0C46BC 800C9C5C 38210028 */  addi	r1, r1, 0x28
/* 0C46C0 800C9C60 7C0803A6 */  mtlr	r0
/* 0C46C4 800C9C64 4E800020 */  blr		

glabel __CARDUpdateDir
/* 0C46C8 800C9C68 7C0802A6 */  mflr	r0
/* 0C46CC 800C9C6C 90010004 */  stw		r0, 4(r1)
/* 0C46D0 800C9C70 9421FFD8 */  stwu	r1, -0x28(r1)
/* 0C46D4 800C9C74 93E10024 */  stw		r31, 0x24(r1)
/* 0C46D8 800C9C78 93C10020 */  stw		r30, 0x20(r1)
/* 0C46DC 800C9C7C 93A1001C */  stw		r29, 0x1c(r1)
/* 0C46E0 800C9C80 3BA40000 */  addi	r29, r4, 0
/* 0C46E4 800C9C84 93810018 */  stw		r28, 0x18(r1)
/* 0C46E8 800C9C88 3B830000 */  addi	r28, r3, 0
/* 0C46EC 800C9C8C 1CBC0110 */  mulli	r5, r28, 0x110
/* 0C46F0 800C9C90 3C608014 */  lis		r3, __CARDBlock@ha
/* 0C46F4 800C9C94 380324D0 */  addi	r0, r3, __CARDBlock@l
/* 0C46F8 800C9C98 7FC02A14 */  add		r30, r0, r5
/* 0C46FC 800C9C9C 801E0000 */  lwz		r0, 0(r30)
/* 0C4700 800C9CA0 2C000000 */  cmpwi	r0, 0
/* 0C4704 800C9CA4 4082000C */  bne		lbl_800C9CB0
/* 0C4708 800C9CA8 3860FFFD */  li		r3, -3
/* 0C470C 800C9CAC 48000060 */  b		lbl_800C9D0C
lbl_800C9CB0:
/* 0C4710 800C9CB0 83FE0084 */  lwz		r31, 0x84(r30)
/* 0C4714 800C9CB4 38801FFC */  li		r4, 0x1ffc
/* 0C4718 800C9CB8 A8BF1FFA */  lha		r5, 0x1ffa(r31)
/* 0C471C 800C9CBC 38DF1FC0 */  addi	r6, r31, 0x1fc0
/* 0C4720 800C9CC0 387F0000 */  addi	r3, r31, 0
/* 0C4724 800C9CC4 38050001 */  addi	r0, r5, 1
/* 0C4728 800C9CC8 B01F1FFA */  sth		r0, 0x1ffa(r31)
/* 0C472C 800C9CCC 38A6003C */  addi	r5, r6, 0x3c
/* 0C4730 800C9CD0 38C6003E */  addi	r6, r6, 0x3e
/* 0C4734 800C9CD4 48000059 */  bl		__CARDCheckSum
/* 0C4738 800C9CD8 387F0000 */  addi	r3, r31, 0
/* 0C473C 800C9CDC 38802000 */  li		r4, 0x2000
/* 0C4740 800C9CE0 4BFDF541 */  bl		DCStoreRange
/* 0C4744 800C9CE4 93BE00D8 */  stw		r29, 0xd8(r30)
/* 0C4748 800C9CE8 3C60800D */  lis		r3, EraseCallback@ha
/* 0C474C 800C9CEC 38A39BA0 */  addi	r5, r3, EraseCallback@l
/* 0C4750 800C9CF0 801E0080 */  lwz		r0, 0x80(r30)
/* 0C4754 800C9CF4 7F83E378 */  mr		r3, r28
/* 0C4758 800C9CF8 809E000C */  lwz		r4, 0xc(r30)
/* 0C475C 800C9CFC 7C00F850 */  subf	r0, r0, r31
/* 0C4760 800C9D00 54009B7E */  srwi	r0, r0, 0xd
/* 0C4764 800C9D04 7C8401D6 */  mullw	r4, r4, r0
/* 0C4768 800C9D08 4BFFDF75 */  bl		__CARDEraseSector
lbl_800C9D0C:
/* 0C476C 800C9D0C 8001002C */  lwz		r0, 0x2c(r1)
/* 0C4770 800C9D10 83E10024 */  lwz		r31, 0x24(r1)
/* 0C4774 800C9D14 83C10020 */  lwz		r30, 0x20(r1)
/* 0C4778 800C9D18 83A1001C */  lwz		r29, 0x1c(r1)
/* 0C477C 800C9D1C 83810018 */  lwz		r28, 0x18(r1)
/* 0C4780 800C9D20 38210028 */  addi	r1, r1, 0x28
/* 0C4784 800C9D24 7C0803A6 */  mtlr	r0
/* 0C4788 800C9D28 4E800020 */  blr		


