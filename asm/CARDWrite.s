# CARDWrite.c
.include "macros.inc"

.section .text, "ax"

.balign 4

WriteCallback:
/* 0C7748 800CCCE8 7C0802A6 */  mflr    r0
/* 0C774C 800CCCEC 90010004 */  stw     r0, 4(r1)
/* 0C7750 800CCCF0 9421FFE0 */  stwu    r1, -0x20(r1)
/* 0C7754 800CCCF4 93E1001C */  stw     r31, 0x1c(r1)
/* 0C7758 800CCCF8 93C10018 */  stw     r30, 0x18(r1)
/* 0C775C 800CCCFC 3BC30000 */  addi    r30, r3, 0
/* 0C7760 800CCD00 3C608014 */  lis     r3, __CARDBlock@ha
/* 0C7764 800CCD04 93A10014 */  stw     r29, 0x14(r1)
/* 0C7768 800CCD08 1CBE0110 */  mulli   r5, r30, 0x110
/* 0C776C 800CCD0C 93810010 */  stw     r28, 0x10(r1)
/* 0C7770 800CCD10 380324D0 */  addi    r0, r3, __CARDBlock@l
/* 0C7774 800CCD14 7C9C2379 */  or.     r28, r4, r4
/* 0C7778 800CCD18 7FE02A14 */  add     r31, r0, r5
/* 0C777C 800CCD1C 418000F0 */  blt     lbl_800CCE0C
/* 0C7780 800CCD20 83BF00C0 */  lwz     r29, 0xc0(r31)
/* 0C7784 800CCD24 807D000C */  lwz     r3, 0xc(r29)
/* 0C7788 800CCD28 2C030000 */  cmpwi   r3, 0
/* 0C778C 800CCD2C 4080000C */  bge     lbl_800CCD38
/* 0C7790 800CCD30 3B80FFF2 */  li      r28, -14
/* 0C7794 800CCD34 480000D8 */  b       lbl_800CCE0C
lbl_800CCD38:
/* 0C7798 800CCD38 801F000C */  lwz     r0, 0xc(r31)
/* 0C779C 800CCD3C 7C001850 */  subf    r0, r0, r3
/* 0C77A0 800CCD40 901D000C */  stw     r0, 0xc(r29)
/* 0C77A4 800CCD44 801D000C */  lwz     r0, 0xc(r29)
/* 0C77A8 800CCD48 2C000000 */  cmpwi   r0, 0
/* 0C77AC 800CCD4C 41810054 */  bgt     lbl_800CCDA0
/* 0C77B0 800CCD50 7FE3FB78 */  mr      r3, r31
/* 0C77B4 800CCD54 4BFFCD75 */  bl      __CARDGetDirBlock
/* 0C77B8 800CCD58 80BD0004 */  lwz     r5, 4(r29)
/* 0C77BC 800CCD5C 3C808000 */  lis     r4, 0x8000
/* 0C77C0 800CCD60 800400F8 */  lwz     r0, 0xf8(r4)
/* 0C77C4 800CCD64 54A43032 */  slwi    r4, r5, 6
/* 0C77C8 800CCD68 7F832214 */  add     r28, r3, r4
/* 0C77CC 800CCD6C 541DF0BE */  srwi    r29, r0, 2
/* 0C77D0 800CCD70 4BFE0FAD */  bl      OSGetTime
/* 0C77D4 800CCD74 38DD0000 */  addi    r6, r29, 0
/* 0C77D8 800CCD78 38A00000 */  li      r5, 0
/* 0C77DC 800CCD7C 4800CE2D */  bl      __div2i
/* 0C77E0 800CCD80 909C0028 */  stw     r4, 0x28(r28)
/* 0C77E4 800CCD84 38000000 */  li      r0, 0
/* 0C77E8 800CCD88 387E0000 */  addi    r3, r30, 0
/* 0C77EC 800CCD8C 809F00D0 */  lwz     r4, 0xd0(r31)
/* 0C77F0 800CCD90 901F00D0 */  stw     r0, 0xd0(r31)
/* 0C77F4 800CCD94 4BFFCED5 */  bl      __CARDUpdateDir
/* 0C77F8 800CCD98 7C7C1B78 */  mr      r28, r3
/* 0C77FC 800CCD9C 48000068 */  b       lbl_800CCE04
lbl_800CCDA0:
/* 0C7800 800CCDA0 7FE3FB78 */  mr      r3, r31
/* 0C7804 800CCDA4 4BFFC921 */  bl      __CARDGetFatBlock
/* 0C7808 800CCDA8 809D0008 */  lwz     r4, 8(r29)
/* 0C780C 800CCDAC 801F000C */  lwz     r0, 0xc(r31)
/* 0C7810 800CCDB0 7C040214 */  add     r0, r4, r0
/* 0C7814 800CCDB4 901D0008 */  stw     r0, 8(r29)
/* 0C7818 800CCDB8 A01D0010 */  lhz     r0, 0x10(r29)
/* 0C781C 800CCDBC 5400083C */  slwi    r0, r0, 1
/* 0C7820 800CCDC0 7C03022E */  lhzx    r0, r3, r0
/* 0C7824 800CCDC4 B01D0010 */  sth     r0, 0x10(r29)
/* 0C7828 800CCDC8 A09D0010 */  lhz     r4, 0x10(r29)
/* 0C782C 800CCDCC 28040005 */  cmplwi  r4, 5
/* 0C7830 800CCDD0 41800010 */  blt     lbl_800CCDE0
/* 0C7834 800CCDD4 A01F0010 */  lhz     r0, 0x10(r31)
/* 0C7838 800CCDD8 7C040040 */  cmplw   r4, r0
/* 0C783C 800CCDDC 4180000C */  blt     lbl_800CCDE8
lbl_800CCDE0:
/* 0C7840 800CCDE0 3B80FFFA */  li      r28, -6
/* 0C7844 800CCDE4 48000028 */  b       lbl_800CCE0C
lbl_800CCDE8:
/* 0C7848 800CCDE8 801F000C */  lwz     r0, 0xc(r31)
/* 0C784C 800CCDEC 3C60800D */  lis     r3, EraseCallback@ha
/* 0C7850 800CCDF0 38A3CE58 */  addi    r5, r3, EraseCallback@l
/* 0C7854 800CCDF4 7C8021D6 */  mullw   r4, r0, r4
/* 0C7858 800CCDF8 387E0000 */  addi    r3, r30, 0
/* 0C785C 800CCDFC 4BFFAE81 */  bl      __CARDEraseSector
/* 0C7860 800CCE00 7C7C1B78 */  mr      r28, r3
lbl_800CCE04:
/* 0C7864 800CCE04 2C1C0000 */  cmpwi   r28, 0
/* 0C7868 800CCE08 40800030 */  bge     lbl_800CCE38
lbl_800CCE0C:
/* 0C786C 800CCE0C 83BF00D0 */  lwz     r29, 0xd0(r31)
/* 0C7870 800CCE10 38000000 */  li      r0, 0
/* 0C7874 800CCE14 387F0000 */  addi    r3, r31, 0
/* 0C7878 800CCE18 901F00D0 */  stw     r0, 0xd0(r31)
/* 0C787C 800CCE1C 7F84E378 */  mr      r4, r28
/* 0C7880 800CCE20 4BFFB0E1 */  bl      __CARDPutControlBlock
/* 0C7884 800CCE24 399D0000 */  addi    r12, r29, 0
/* 0C7888 800CCE28 7D8803A6 */  mtlr    r12
/* 0C788C 800CCE2C 387E0000 */  addi    r3, r30, 0
/* 0C7890 800CCE30 389C0000 */  addi    r4, r28, 0
/* 0C7894 800CCE34 4E800021 */  blrl    
lbl_800CCE38:
/* 0C7898 800CCE38 80010024 */  lwz     r0, 0x24(r1)
/* 0C789C 800CCE3C 83E1001C */  lwz     r31, 0x1c(r1)
/* 0C78A0 800CCE40 83C10018 */  lwz     r30, 0x18(r1)
/* 0C78A4 800CCE44 83A10014 */  lwz     r29, 0x14(r1)
/* 0C78A8 800CCE48 83810010 */  lwz     r28, 0x10(r1)
/* 0C78AC 800CCE4C 38210020 */  addi    r1, r1, 0x20
/* 0C78B0 800CCE50 7C0803A6 */  mtlr    r0
/* 0C78B4 800CCE54 4E800020 */  blr     

EraseCallback:
/* 0C78B8 800CCE58 7C0802A6 */  mflr    r0
/* 0C78BC 800CCE5C 90010004 */  stw     r0, 4(r1)
/* 0C78C0 800CCE60 9421FFE0 */  stwu    r1, -0x20(r1)
/* 0C78C4 800CCE64 93E1001C */  stw     r31, 0x1c(r1)
/* 0C78C8 800CCE68 93C10018 */  stw     r30, 0x18(r1)
/* 0C78CC 800CCE6C 93A10014 */  stw     r29, 0x14(r1)
/* 0C78D0 800CCE70 7C9D2379 */  or.     r29, r4, r4
/* 0C78D4 800CCE74 93810010 */  stw     r28, 0x10(r1)
/* 0C78D8 800CCE78 3B830000 */  addi    r28, r3, 0
/* 0C78DC 800CCE7C 1CBC0110 */  mulli   r5, r28, 0x110
/* 0C78E0 800CCE80 3C608014 */  lis     r3, __CARDBlock@ha
/* 0C78E4 800CCE84 380324D0 */  addi    r0, r3, __CARDBlock@l
/* 0C78E8 800CCE88 7FE02A14 */  add     r31, r0, r5
/* 0C78EC 800CCE8C 41800030 */  blt     lbl_800CCEBC
/* 0C78F0 800CCE90 809F00C0 */  lwz     r4, 0xc0(r31)
/* 0C78F4 800CCE94 3C60800D */  lis     r3, WriteCallback@ha
/* 0C78F8 800CCE98 38E3CCE8 */  addi    r7, r3, WriteCallback@l
/* 0C78FC 800CCE9C 80BF000C */  lwz     r5, 0xc(r31)
/* 0C7900 800CCEA0 A0040010 */  lhz     r0, 0x10(r4)
/* 0C7904 800CCEA4 80DF00B4 */  lwz     r6, 0xb4(r31)
/* 0C7908 800CCEA8 387C0000 */  addi    r3, r28, 0
/* 0C790C 800CCEAC 7C8501D6 */  mullw   r4, r5, r0
/* 0C7910 800CCEB0 4BFFC799 */  bl      __CARDWrite
/* 0C7914 800CCEB4 7C7D1B79 */  or.     r29, r3, r3
/* 0C7918 800CCEB8 40800030 */  bge     lbl_800CCEE8
lbl_800CCEBC:
/* 0C791C 800CCEBC 83DF00D0 */  lwz     r30, 0xd0(r31)
/* 0C7920 800CCEC0 38000000 */  li      r0, 0
/* 0C7924 800CCEC4 387F0000 */  addi    r3, r31, 0
/* 0C7928 800CCEC8 901F00D0 */  stw     r0, 0xd0(r31)
/* 0C792C 800CCECC 7FA4EB78 */  mr      r4, r29
/* 0C7930 800CCED0 4BFFB031 */  bl      __CARDPutControlBlock
/* 0C7934 800CCED4 399E0000 */  addi    r12, r30, 0
/* 0C7938 800CCED8 7D8803A6 */  mtlr    r12
/* 0C793C 800CCEDC 387C0000 */  addi    r3, r28, 0
/* 0C7940 800CCEE0 389D0000 */  addi    r4, r29, 0
/* 0C7944 800CCEE4 4E800021 */  blrl    
lbl_800CCEE8:
/* 0C7948 800CCEE8 80010024 */  lwz     r0, 0x24(r1)
/* 0C794C 800CCEEC 83E1001C */  lwz     r31, 0x1c(r1)
/* 0C7950 800CCEF0 83C10018 */  lwz     r30, 0x18(r1)
/* 0C7954 800CCEF4 83A10014 */  lwz     r29, 0x14(r1)
/* 0C7958 800CCEF8 83810010 */  lwz     r28, 0x10(r1)
/* 0C795C 800CCEFC 38210020 */  addi    r1, r1, 0x20
/* 0C7960 800CCF00 7C0803A6 */  mtlr    r0
/* 0C7964 800CCF04 4E800020 */  blr     

glabel CARDWriteAsync
/* 0C7968 800CCF08 7C0802A6 */  mflr    r0
/* 0C796C 800CCF0C 90010004 */  stw     r0, 4(r1)
/* 0C7970 800CCF10 9421FFC8 */  stwu    r1, -0x38(r1)
/* 0C7974 800CCF14 BF610024 */  stmw    r27, 0x24(r1)
/* 0C7978 800CCF18 3B860000 */  addi    r28, r6, 0
/* 0C797C 800CCF1C 3B650000 */  addi    r27, r5, 0
/* 0C7980 800CCF20 3BE40000 */  addi    r31, r4, 0
/* 0C7984 800CCF24 3BC30000 */  addi    r30, r3, 0
/* 0C7988 800CCF28 3BA70000 */  addi    r29, r7, 0
/* 0C798C 800CCF2C 389B0000 */  addi    r4, r27, 0
/* 0C7990 800CCF30 38BC0000 */  addi    r5, r28, 0
/* 0C7994 800CCF34 38C1001C */  addi    r6, r1, 0x1c
/* 0C7998 800CCF38 4BFFF93D */  bl      __CARDSeek
/* 0C799C 800CCF3C 2C030000 */  cmpwi   r3, 0
/* 0C79A0 800CCF40 40800008 */  bge     lbl_800CCF48
/* 0C79A4 800CCF44 480000C4 */  b       lbl_800CD008
lbl_800CCF48:
/* 0C79A8 800CCF48 8061001C */  lwz     r3, 0x1c(r1)
/* 0C79AC 800CCF4C 8083000C */  lwz     r4, 0xc(r3)
/* 0C79B0 800CCF50 3884FFFF */  addi    r4, r4, -1
/* 0C79B4 800CCF54 7F802039 */  and.    r0, r28, r4
/* 0C79B8 800CCF58 4082000C */  bne     lbl_800CCF64
/* 0C79BC 800CCF5C 7F602039 */  and.    r0, r27, r4
/* 0C79C0 800CCF60 41820010 */  beq     lbl_800CCF70
lbl_800CCF64:
/* 0C79C4 800CCF64 3880FF80 */  li      r4, -128
/* 0C79C8 800CCF68 4BFFAF99 */  bl      __CARDPutControlBlock
/* 0C79CC 800CCF6C 4800009C */  b       lbl_800CD008
lbl_800CCF70:
/* 0C79D0 800CCF70 4BFFCB59 */  bl      __CARDGetDirBlock
/* 0C79D4 800CCF74 801E0004 */  lwz     r0, 4(r30)
/* 0C79D8 800CCF78 54003032 */  slwi    r0, r0, 6
/* 0C79DC 800CCF7C 7C830214 */  add     r4, r3, r0
/* 0C79E0 800CCF80 8061001C */  lwz     r3, 0x1c(r1)
/* 0C79E4 800CCF84 4BFFF0B1 */  bl      __CARDIsWritable
/* 0C79E8 800CCF88 7C641B79 */  or.     r4, r3, r3
/* 0C79EC 800CCF8C 40800010 */  bge     lbl_800CCF9C
/* 0C79F0 800CCF90 8061001C */  lwz     r3, 0x1c(r1)
/* 0C79F4 800CCF94 4BFFAF6D */  bl      __CARDPutControlBlock
/* 0C79F8 800CCF98 48000070 */  b       lbl_800CD008
lbl_800CCF9C:
/* 0C79FC 800CCF9C 387F0000 */  addi    r3, r31, 0
/* 0C7A00 800CCFA0 389B0000 */  addi    r4, r27, 0
/* 0C7A04 800CCFA4 4BFDC27D */  bl      DCStoreRange
/* 0C7A08 800CCFA8 281D0000 */  cmplwi  r29, 0
/* 0C7A0C 800CCFAC 4182000C */  beq     lbl_800CCFB8
/* 0C7A10 800CCFB0 7FA0EB78 */  mr      r0, r29
/* 0C7A14 800CCFB4 4800000C */  b       lbl_800CCFC0
lbl_800CCFB8:
/* 0C7A18 800CCFB8 3C60800C */  lis     r3, __CARDDefaultApiCallback@ha
/* 0C7A1C 800CCFBC 38036EE8 */  addi    r0, r3, __CARDDefaultApiCallback@l
lbl_800CCFC0:
/* 0C7A20 800CCFC0 8081001C */  lwz     r4, 0x1c(r1)
/* 0C7A24 800CCFC4 3C60800D */  lis     r3, EraseCallback@ha
/* 0C7A28 800CCFC8 38A3CE58 */  addi    r5, r3, EraseCallback@l
/* 0C7A2C 800CCFCC 900400D0 */  stw     r0, 0xd0(r4)
/* 0C7A30 800CCFD0 8061001C */  lwz     r3, 0x1c(r1)
/* 0C7A34 800CCFD4 93E300B4 */  stw     r31, 0xb4(r3)
/* 0C7A38 800CCFD8 8061001C */  lwz     r3, 0x1c(r1)
/* 0C7A3C 800CCFDC A01E0010 */  lhz     r0, 0x10(r30)
/* 0C7A40 800CCFE0 8083000C */  lwz     r4, 0xc(r3)
/* 0C7A44 800CCFE4 807E0000 */  lwz     r3, 0(r30)
/* 0C7A48 800CCFE8 7C8401D6 */  mullw   r4, r4, r0
/* 0C7A4C 800CCFEC 4BFFAC91 */  bl      __CARDEraseSector
/* 0C7A50 800CCFF0 7C7E1B79 */  or.     r30, r3, r3
/* 0C7A54 800CCFF4 40800010 */  bge     lbl_800CD004
/* 0C7A58 800CCFF8 8061001C */  lwz     r3, 0x1c(r1)
/* 0C7A5C 800CCFFC 7FC4F378 */  mr      r4, r30
/* 0C7A60 800CD000 4BFFAF01 */  bl      __CARDPutControlBlock
lbl_800CD004:
/* 0C7A64 800CD004 7FC3F378 */  mr      r3, r30
lbl_800CD008:
/* 0C7A68 800CD008 BB610024 */  lmw     r27, 0x24(r1)
/* 0C7A6C 800CD00C 8001003C */  lwz     r0, 0x3c(r1)
/* 0C7A70 800CD010 38210038 */  addi    r1, r1, 0x38
/* 0C7A74 800CD014 7C0803A6 */  mtlr    r0
/* 0C7A78 800CD018 4E800020 */  blr     


