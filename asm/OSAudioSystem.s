# OSAudioSystem.c
.include "macros.inc"

.section .text, "ax"

.balign 4

glabel __OSInitAudioSystem
/* 0A397C 800A8F1C 7C0802A6 */  mflr	r0
/* 0A3980 800A8F20 90010004 */  stw		r0, 4(r1)
/* 0A3984 800A8F24 9421FFD0 */  stwu	r1, -0x30(r1)
/* 0A3988 800A8F28 BF210014 */  stmw	r25, 0x14(r1)
/* 0A398C 800A8F2C 4BFFFFD1 */  bl		OSGetArenaHi
/* 0A3990 800A8F30 3C808100 */  lis		r4, 0x8100
/* 0A3994 800A8F34 38A00080 */  li		r5, 0x80
/* 0A3998 800A8F38 3863FF80 */  addi	r3, r3, -128
/* 0A399C 800A8F3C 4BF5C589 */  bl		memcpy
/* 0A39A0 800A8F40 3C608010 */  lis		r3, DSPInitCode@ha
/* 0A39A4 800A8F44 3883EC18 */  addi	r4, r3, DSPInitCode@l
/* 0A39A8 800A8F48 3C608100 */  lis		r3, 0x8100
/* 0A39AC 800A8F4C 38A00080 */  li		r5, 0x80
/* 0A39B0 800A8F50 4BF5C575 */  bl		memcpy
/* 0A39B4 800A8F54 3C608100 */  lis		r3, 0x8100
/* 0A39B8 800A8F58 38800080 */  li		r4, 0x80
/* 0A39BC 800A8F5C 48000295 */  bl		DCFlushRange
/* 0A39C0 800A8F60 3C60CC00 */  lis		r3, 0xcc00
/* 0A39C4 800A8F64 38635000 */  addi	r3, r3, 0x5000
/* 0A39C8 800A8F68 38000043 */  li		r0, 0x43
/* 0A39CC 800A8F6C B0030012 */  sth		r0, 0x12(r3)
/* 0A39D0 800A8F70 3BE3000A */  addi	r31, r3, 0xa
/* 0A39D4 800A8F74 380008AC */  li		r0, 0x8ac
/* 0A39D8 800A8F78 B003000A */  sth		r0, 0xa(r3)
/* 0A39DC 800A8F7C A003000A */  lhz		r0, 0xa(r3)
/* 0A39E0 800A8F80 60000001 */  ori		r0, r0, 1
/* 0A39E4 800A8F84 B003000A */  sth		r0, 0xa(r3)
lbl_800A8F88:
/* 0A39E8 800A8F88 A01F0000 */  lhz		r0, 0(r31)
/* 0A39EC 800A8F8C 540007FF */  clrlwi.	r0, r0, 0x1f
/* 0A39F0 800A8F90 4082FFF8 */  bne		lbl_800A8F88
/* 0A39F4 800A8F94 38000000 */  li		r0, 0
/* 0A39F8 800A8F98 3C80CC00 */  lis		r4, 0xcc00
/* 0A39FC 800A8F9C B0045000 */  sth		r0, 0x5000(r4)
lbl_800A8FA0:
/* 0A3A00 800A8FA0 3BC45000 */  addi	r30, r4, 0x5000
/* 0A3A04 800A8FA4 A47E0004 */  lhzu	r3, 4(r30)
/* 0A3A08 800A8FA8 3BA45000 */  addi	r29, r4, 0x5000
/* 0A3A0C 800A8FAC A41D0006 */  lhzu	r0, 6(r29)
/* 0A3A10 800A8FB0 5060801E */  rlwimi	r0, r3, 0x10, 0, 0xf
/* 0A3A14 800A8FB4 54000001 */  rlwinm.	r0, r0, 0, 0, 0
/* 0A3A18 800A8FB8 4082FFE8 */  bne		lbl_800A8FA0
/* 0A3A1C 800A8FBC 3C60CC00 */  lis		r3, 0xcc00
/* 0A3A20 800A8FC0 3C000100 */  lis		r0, 0x100
/* 0A3A24 800A8FC4 3B635000 */  addi	r27, r3, 0x5000
/* 0A3A28 800A8FC8 941B0020 */  stwu	r0, 0x20(r27)
/* 0A3A2C 800A8FCC 38000000 */  li		r0, 0
/* 0A3A30 800A8FD0 3B435000 */  addi	r26, r3, 0x5000
/* 0A3A34 800A8FD4 941A0024 */  stwu	r0, 0x24(r26)
/* 0A3A38 800A8FD8 38000020 */  li		r0, 0x20
/* 0A3A3C 800A8FDC 3B235000 */  addi	r25, r3, 0x5000
/* 0A3A40 800A8FE0 94190028 */  stwu	r0, 0x28(r25)
/* 0A3A44 800A8FE4 A07F0000 */  lhz		r3, 0(r31)
/* 0A3A48 800A8FE8 48000008 */  b		lbl_800A8FF0
lbl_800A8FEC:
/* 0A3A4C 800A8FEC A07F0000 */  lhz		r3, 0(r31)
lbl_800A8FF0:
/* 0A3A50 800A8FF0 546006B5 */  rlwinm.	r0, r3, 0, 0x1a, 0x1a
/* 0A3A54 800A8FF4 4182FFF8 */  beq		lbl_800A8FEC
/* 0A3A58 800A8FF8 B07F0000 */  sth		r3, 0(r31)
/* 0A3A5C 800A8FFC 48004D39 */  bl		OSGetTick
/* 0A3A60 800A9000 7C7C1B78 */  mr		r28, r3
lbl_800A9004:
/* 0A3A64 800A9004 48004D31 */  bl		OSGetTick
/* 0A3A68 800A9008 7C1C1850 */  subf	r0, r28, r3
/* 0A3A6C 800A900C 2C000892 */  cmpwi	r0, 0x892
/* 0A3A70 800A9010 4180FFF4 */  blt		lbl_800A9004
/* 0A3A74 800A9014 3C000100 */  lis		r0, 0x100
/* 0A3A78 800A9018 901B0000 */  stw		r0, 0(r27)
/* 0A3A7C 800A901C 38600000 */  li		r3, 0
/* 0A3A80 800A9020 38000020 */  li		r0, 0x20
/* 0A3A84 800A9024 907A0000 */  stw		r3, 0(r26)
/* 0A3A88 800A9028 90190000 */  stw		r0, 0(r25)
/* 0A3A8C 800A902C A07F0000 */  lhz		r3, 0(r31)
/* 0A3A90 800A9030 48000008 */  b		lbl_800A9038
lbl_800A9034:
/* 0A3A94 800A9034 A07F0000 */  lhz		r3, 0(r31)
lbl_800A9038:
/* 0A3A98 800A9038 546006B5 */  rlwinm.	r0, r3, 0, 0x1a, 0x1a
/* 0A3A9C 800A903C 4182FFF8 */  beq		lbl_800A9034
/* 0A3AA0 800A9040 B07F0000 */  sth		r3, 0(r31)
/* 0A3AA4 800A9044 A01F0000 */  lhz		r0, 0(r31)
/* 0A3AA8 800A9048 54000566 */  rlwinm	r0, r0, 0, 0x15, 0x13
/* 0A3AAC 800A904C B01F0000 */  sth		r0, 0(r31)
lbl_800A9050:
/* 0A3AB0 800A9050 A01F0000 */  lhz		r0, 0(r31)
/* 0A3AB4 800A9054 5400056B */  rlwinm.	r0, r0, 0, 0x15, 0x15
/* 0A3AB8 800A9058 4082FFF8 */  bne		lbl_800A9050
/* 0A3ABC 800A905C A01F0000 */  lhz		r0, 0(r31)
/* 0A3AC0 800A9060 540007B8 */  rlwinm	r0, r0, 0, 0x1e, 0x1c
/* 0A3AC4 800A9064 B01F0000 */  sth		r0, 0(r31)
/* 0A3AC8 800A9068 A01E0000 */  lhz		r0, 0(r30)
/* 0A3ACC 800A906C 48000008 */  b		lbl_800A9074
lbl_800A9070:
/* 0A3AD0 800A9070 A01E0000 */  lhz		r0, 0(r30)
lbl_800A9074:
/* 0A3AD4 800A9074 5405043E */  clrlwi	r5, r0, 0x10
/* 0A3AD8 800A9078 54000421 */  rlwinm.	r0, r0, 0, 0x10, 0x10
/* 0A3ADC 800A907C 4182FFF4 */  beq		lbl_800A9070
/* 0A3AE0 800A9080 A01F0000 */  lhz		r0, 0(r31)
/* 0A3AE4 800A9084 A09D0000 */  lhz		r4, 0(r29)
/* 0A3AE8 800A9088 60000004 */  ori		r0, r0, 4
/* 0A3AEC 800A908C B01F0000 */  sth		r0, 0(r31)
/* 0A3AF0 800A9090 380008AC */  li		r0, 0x8ac
/* 0A3AF4 800A9094 B01F0000 */  sth		r0, 0(r31)
/* 0A3AF8 800A9098 A01F0000 */  lhz		r0, 0(r31)
/* 0A3AFC 800A909C 60000001 */  ori		r0, r0, 1
/* 0A3B00 800A90A0 B01F0000 */  sth		r0, 0(r31)
lbl_800A90A4:
/* 0A3B04 800A90A4 A01F0000 */  lhz		r0, 0(r31)
/* 0A3B08 800A90A8 540007FF */  clrlwi.	r0, r0, 0x1f
/* 0A3B0C 800A90AC 4082FFF8 */  bne		lbl_800A90A4
/* 0A3B10 800A90B0 4BFFFE4D */  bl		OSGetArenaHi
/* 0A3B14 800A90B4 3883FF80 */  addi	r4, r3, -128
/* 0A3B18 800A90B8 3C608100 */  lis		r3, 0x8100
/* 0A3B1C 800A90BC 38A00080 */  li		r5, 0x80
/* 0A3B20 800A90C0 4BF5C405 */  bl		memcpy
/* 0A3B24 800A90C4 BB210014 */  lmw		r25, 0x14(r1)
/* 0A3B28 800A90C8 80010034 */  lwz		r0, 0x34(r1)
/* 0A3B2C 800A90CC 38210030 */  addi	r1, r1, 0x30
/* 0A3B30 800A90D0 7C0803A6 */  mtlr	r0
/* 0A3B34 800A90D4 4E800020 */  blr		

glabel __OSStopAudioSystem
/* 0A3B38 800A90D8 7C0802A6 */  mflr	r0
/* 0A3B3C 800A90DC 3C60CC00 */  lis		r3, 0xcc00
/* 0A3B40 800A90E0 90010004 */  stw		r0, 4(r1)
/* 0A3B44 800A90E4 38000804 */  li		r0, 0x804
/* 0A3B48 800A90E8 9421FFF0 */  stwu	r1, -0x10(r1)
/* 0A3B4C 800A90EC 93E1000C */  stw		r31, 0xc(r1)
/* 0A3B50 800A90F0 3BE35000 */  addi	r31, r3, 0x5000
/* 0A3B54 800A90F4 38635000 */  addi	r3, r3, 0x5000
/* 0A3B58 800A90F8 93C10008 */  stw		r30, 8(r1)
/* 0A3B5C 800A90FC B01F000A */  sth		r0, 0xa(r31)
/* 0A3B60 800A9100 A0030036 */  lhz		r0, 0x36(r3)
/* 0A3B64 800A9104 5400045E */  rlwinm	r0, r0, 0, 0x11, 0xf
/* 0A3B68 800A9108 B0030036 */  sth		r0, 0x36(r3)
/* 0A3B6C 800A910C A41F000A */  lhzu	r0, 0xa(r31)
/* 0A3B70 800A9110 48000008 */  b		lbl_800A9118
lbl_800A9114:
/* 0A3B74 800A9114 A01F0000 */  lhz		r0, 0(r31)
lbl_800A9118:
/* 0A3B78 800A9118 5400056B */  rlwinm.	r0, r0, 0, 0x15, 0x15
/* 0A3B7C 800A911C 4082FFF8 */  bne		lbl_800A9114
/* 0A3B80 800A9120 A01F0000 */  lhz		r0, 0(r31)
/* 0A3B84 800A9124 48000008 */  b		lbl_800A912C
lbl_800A9128:
/* 0A3B88 800A9128 A01F0000 */  lhz		r0, 0(r31)
lbl_800A912C:
/* 0A3B8C 800A912C 540005AD */  rlwinm.	r0, r0, 0, 0x16, 0x16
/* 0A3B90 800A9130 4082FFF8 */  bne		lbl_800A9128
/* 0A3B94 800A9134 380008AC */  li		r0, 0x8ac
/* 0A3B98 800A9138 3C60CC00 */  lis		r3, 0xcc00
/* 0A3B9C 800A913C B01F0000 */  sth		r0, 0(r31)
/* 0A3BA0 800A9140 38000000 */  li		r0, 0
/* 0A3BA4 800A9144 B0035000 */  sth		r0, 0x5000(r3)
/* 0A3BA8 800A9148 38835000 */  addi	r4, r3, 0x5000
lbl_800A914C:
/* 0A3BAC 800A914C A0640004 */  lhz		r3, 4(r4)
/* 0A3BB0 800A9150 A0040006 */  lhz		r0, 6(r4)
/* 0A3BB4 800A9154 5060801E */  rlwimi	r0, r3, 0x10, 0, 0xf
/* 0A3BB8 800A9158 54000001 */  rlwinm.	r0, r0, 0, 0, 0
/* 0A3BBC 800A915C 4082FFF0 */  bne		lbl_800A914C
/* 0A3BC0 800A9160 48004BD5 */  bl		OSGetTick
/* 0A3BC4 800A9164 7C7E1B78 */  mr		r30, r3
lbl_800A9168:
/* 0A3BC8 800A9168 48004BCD */  bl		OSGetTick
/* 0A3BCC 800A916C 7C1E1850 */  subf	r0, r30, r3
/* 0A3BD0 800A9170 2C00002C */  cmpwi	r0, 0x2c
/* 0A3BD4 800A9174 4180FFF4 */  blt		lbl_800A9168
/* 0A3BD8 800A9178 A01F0000 */  lhz		r0, 0(r31)
/* 0A3BDC 800A917C 60000001 */  ori		r0, r0, 1
/* 0A3BE0 800A9180 B01F0000 */  sth		r0, 0(r31)
/* 0A3BE4 800A9184 A01F0000 */  lhz		r0, 0(r31)
/* 0A3BE8 800A9188 48000008 */  b		lbl_800A9190
lbl_800A918C:
/* 0A3BEC 800A918C A01F0000 */  lhz		r0, 0(r31)
lbl_800A9190:
/* 0A3BF0 800A9190 540007FF */  clrlwi.	r0, r0, 0x1f
/* 0A3BF4 800A9194 4082FFF8 */  bne		lbl_800A918C
/* 0A3BF8 800A9198 80010014 */  lwz		r0, 0x14(r1)
/* 0A3BFC 800A919C 83E1000C */  lwz		r31, 0xc(r1)
/* 0A3C00 800A91A0 83C10008 */  lwz		r30, 8(r1)
/* 0A3C04 800A91A4 38210010 */  addi	r1, r1, 0x10
/* 0A3C08 800A91A8 7C0803A6 */  mtlr	r0
/* 0A3C0C 800A91AC 4E800020 */  blr		


.section .data, "wa"

.balign 8

/* 000FBC98 800FEC18 0080 */
DSPInitCode:
    .long 0x029F0010, 0x029F0033, 0x029F0034, 0x029F0035, 0x029F0036, 0x029F0037, 0x029F0038, 0x029F0039
    .long 0x12061203, 0x12041205, 0x00808000, 0x0088FFFF, 0x00841000, 0x0064001D, 0x02180000, 0x81001C1E
    .long 0x00441B1E, 0x00840800, 0x00640027, 0x191E0000, 0x00DEFFFC, 0x02A08000, 0x029C0028, 0x16FC0054
    .long 0x16FD4348, 0x002102FF, 0x02FF02FF, 0x02FF02FF, 0x02FF02FF, 0x00000000, 0x00000000, 0x00000000


